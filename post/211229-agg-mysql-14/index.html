<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>MySQL8新特性</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="尚硅谷MySQL筆記-14">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="MySQL8新特性" />
<meta property="og:description" content="尚硅谷MySQL筆記-14" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/211229-agg-mysql-14/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-12-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-12-29T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL8新特性"/>
<meta name="twitter:description" content="尚硅谷MySQL筆記-14"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            柚子茶室
        </div>
        
        <div class="nav-subtitle">
            紀錄自學大小事
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                首頁🏠
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                系列文📖
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                標籤🏷️
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                關於我🐣
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目錄 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#mysql8%e6%96%b0%e7%89%b9%e6%80%a7%e6%a6%82%e8%bf%b0" onclick="onNavClick(`#mysql8新特性概述-nav`)" id="mysql8新特性概述-nav">
									MySQL8新特性概述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#11-mysql80-%e6%96%b0%e5%a2%9e%e7%89%b9%e6%80%a7" onclick="onNavClick(`#11-mysql80-新增特性-nav`)" id="11-mysql80-新增特性-nav">
									1.1 MySQL8.0 新增特性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#12-mysql80%e7%a7%bb%e9%99%a4%e7%9a%84%e8%88%8a%e7%89%b9%e6%80%a7" onclick="onNavClick(`#12-mysql80移除的舊特性-nav`)" id="12-mysql80移除的舊特性-nav">
									1.2 MySQL8.0移除的舊特性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#2-%e6%96%b0%e7%89%b9%e6%80%a71%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8" onclick="onNavClick(`#2-新特性1視窗函數-nav`)" id="2-新特性1視窗函數-nav">
									2. 新特性1：視窗函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#21-%e4%bd%bf%e7%94%a8%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8%e5%89%8d%e5%be%8c%e5%b0%8d%e6%af%94" onclick="onNavClick(`#21-使用視窗函數前後對比-nav`)" id="21-使用視窗函數前後對比-nav">
									2.1 使用視窗函數前後對比
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#22-%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8%e5%88%86%e9%a1%9e" onclick="onNavClick(`#22-視窗函數分類-nav`)" id="22-視窗函數分類-nav">
									2.2 視窗函數分類
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23-%e8%aa%9e%e6%b3%95%e7%b5%90%e6%a7%8b" onclick="onNavClick(`#23-語法結構-nav`)" id="23-語法結構-nav">
									2.3 語法結構
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#24-%e5%88%86%e9%a1%9e%e8%ac%9b%e8%a7%a3" onclick="onNavClick(`#24-分類講解-nav`)" id="24-分類講解-nav">
									2.4 分類講解
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#1-%e5%ba%8f%e8%99%9f%e5%87%bd%e6%95%b8" onclick="onNavClick(`#1-序號函數-nav`)" id="1-序號函數-nav">
									1. 序號函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e5%88%86%e4%bd%88%e5%87%bd%e6%95%b8" onclick="onNavClick(`#2-分佈函數-nav`)" id="2-分佈函數-nav">
									2. 分佈函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-%e5%89%8d%e5%be%8c%e5%87%bd%e6%95%b8" onclick="onNavClick(`#3-前後函數-nav`)" id="3-前後函數-nav">
									3. 前後函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e9%a6%96%e5%b0%be%e5%87%bd%e6%95%b8" onclick="onNavClick(`#4-首尾函數-nav`)" id="4-首尾函數-nav">
									4. 首尾函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#5-%e5%85%b6%e4%bb%96%e5%87%bd%e6%95%b8" onclick="onNavClick(`#5-其他函數-nav`)" id="5-其他函數-nav">
									5. 其他函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#25-%e5%b0%8f-%e7%b5%90" onclick="onNavClick(`#25-小-結-nav`)" id="25-小-結-nav">
									2.5 小 結
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#3-%e6%96%b0%e7%89%b9%e6%80%a72%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#3-新特性2公用表運算式-nav`)" id="3-新特性2公用表運算式-nav">
									3. 新特性2：公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#31-%e6%99%ae%e9%80%9a%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#31-普通公用表運算式-nav`)" id="31-普通公用表運算式-nav">
									3.1 普通公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#32-%e9%81%9e%e8%bf%b4%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#32-遞迴公用表運算式-nav`)" id="32-遞迴公用表運算式-nav">
									3.2 遞迴公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#33-%e5%b0%8f-%e7%b5%90" onclick="onNavClick(`#33-小-結-nav`)" id="33-小-結-nav">
									3.3 小 結
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    首頁🏠
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    系列文📖
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    標籤🏷️
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    關於我🐣
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目錄 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#mysql8%e6%96%b0%e7%89%b9%e6%80%a7%e6%a6%82%e8%bf%b0" onclick="onNavClick(`#mysql8新特性概述-nav`)" id="mysql8新特性概述-nav">
									MySQL8新特性概述
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#11-mysql80-%e6%96%b0%e5%a2%9e%e7%89%b9%e6%80%a7" onclick="onNavClick(`#11-mysql80-新增特性-nav`)" id="11-mysql80-新增特性-nav">
									1.1 MySQL8.0 新增特性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#12-mysql80%e7%a7%bb%e9%99%a4%e7%9a%84%e8%88%8a%e7%89%b9%e6%80%a7" onclick="onNavClick(`#12-mysql80移除的舊特性-nav`)" id="12-mysql80移除的舊特性-nav">
									1.2 MySQL8.0移除的舊特性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#2-%e6%96%b0%e7%89%b9%e6%80%a71%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8" onclick="onNavClick(`#2-新特性1視窗函數-nav`)" id="2-新特性1視窗函數-nav">
									2. 新特性1：視窗函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#21-%e4%bd%bf%e7%94%a8%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8%e5%89%8d%e5%be%8c%e5%b0%8d%e6%af%94" onclick="onNavClick(`#21-使用視窗函數前後對比-nav`)" id="21-使用視窗函數前後對比-nav">
									2.1 使用視窗函數前後對比
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#22-%e8%a6%96%e7%aa%97%e5%87%bd%e6%95%b8%e5%88%86%e9%a1%9e" onclick="onNavClick(`#22-視窗函數分類-nav`)" id="22-視窗函數分類-nav">
									2.2 視窗函數分類
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23-%e8%aa%9e%e6%b3%95%e7%b5%90%e6%a7%8b" onclick="onNavClick(`#23-語法結構-nav`)" id="23-語法結構-nav">
									2.3 語法結構
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#24-%e5%88%86%e9%a1%9e%e8%ac%9b%e8%a7%a3" onclick="onNavClick(`#24-分類講解-nav`)" id="24-分類講解-nav">
									2.4 分類講解
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#1-%e5%ba%8f%e8%99%9f%e5%87%bd%e6%95%b8" onclick="onNavClick(`#1-序號函數-nav`)" id="1-序號函數-nav">
									1. 序號函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#2-%e5%88%86%e4%bd%88%e5%87%bd%e6%95%b8" onclick="onNavClick(`#2-分佈函數-nav`)" id="2-分佈函數-nav">
									2. 分佈函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#3-%e5%89%8d%e5%be%8c%e5%87%bd%e6%95%b8" onclick="onNavClick(`#3-前後函數-nav`)" id="3-前後函數-nav">
									3. 前後函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#4-%e9%a6%96%e5%b0%be%e5%87%bd%e6%95%b8" onclick="onNavClick(`#4-首尾函數-nav`)" id="4-首尾函數-nav">
									4. 首尾函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#5-%e5%85%b6%e4%bb%96%e5%87%bd%e6%95%b8" onclick="onNavClick(`#5-其他函數-nav`)" id="5-其他函數-nav">
									5. 其他函數
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#25-%e5%b0%8f-%e7%b5%90" onclick="onNavClick(`#25-小-結-nav`)" id="25-小-結-nav">
									2.5 小 結
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#3-%e6%96%b0%e7%89%b9%e6%80%a72%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#3-新特性2公用表運算式-nav`)" id="3-新特性2公用表運算式-nav">
									3. 新特性2：公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#31-%e6%99%ae%e9%80%9a%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#31-普通公用表運算式-nav`)" id="31-普通公用表運算式-nav">
									3.1 普通公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#32-%e9%81%9e%e8%bf%b4%e5%85%ac%e7%94%a8%e8%a1%a8%e9%81%8b%e7%ae%97%e5%bc%8f" onclick="onNavClick(`#32-遞迴公用表運算式-nav`)" id="32-遞迴公用表運算式-nav">
									3.2 遞迴公用表運算式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#33-%e5%b0%8f-%e7%b5%90" onclick="onNavClick(`#33-小-結-nav`)" id="33-小-結-nav">
									3.3 小 結
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            柚子茶室
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">柚子茶室</div>
        
        <div class="single-column-header-subtitle">紀錄自學大小事</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/mysql.jpg')"
                    
                
            >
                <div class="post-title">
                    MySQL8新特性
                    
                    <div class="post-subtitle">
                        尚硅谷MySQL筆記-14
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-12-29 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/mysql%E7%B7%9A%E4%B8%8A%E8%AA%B2">MySQL線上課</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/sql">sql</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="mysql8新特性概述">MySQL8新特性概述</h2>
<blockquote>
<p>一樣跳過</p>
</blockquote>
<p><code>MySQL從5.7版本直接跳躍發佈了8.0版本</code>，可見這是一個令人興奮的里程碑版本。MySQL 8版本在功能上做了顯著的改進與增強，開發者對MySQL的原始程式碼進行了重構，最突出的一點是多MySQL Optimizer優化器進行了改進。不僅在速度上得到了改善，還為使用者帶來了更好的性能和更棒的體驗。</p>
<h3 id="11-mysql80-新增特性">1.1 MySQL8.0 新增特性</h3>
<p><strong>1. 更簡便的NoSQL支持</strong>
NoSQL泛指非關係型資料庫和資料存儲。隨著互聯網平臺的規模飛速發展，傳統的關係型資料庫已經越來越不能滿足需求。從5.6版本開始，MySQL就開始支援簡單的NoSQL存儲功能。MySQL 8對這一功能做了優化，以更靈活的方式實現NoSQL功能，不再依賴模式（schema）。</p>
<p><strong>2. 更好的索引</strong>
在查詢中，正確地使用索引可以提高查詢的效率。MySQL 8中新增了<code>隱藏索引</code>和<code>降冪索引</code>。隱藏索引可以用來測試去掉索引對查詢性能的影響。在查詢中混合存在多列索引時，使用降冪索引可以提高查詢的性能。</p>
<p><strong>3.更完善的JSON支援</strong>
MySQL從5.7開始支援原生JSON資料的存儲，MySQL 8對這一功能做了優化，增加了彙總函式<code>JSON_ARRAYAGG()</code>和<code>JSON_OBJECTAGG()</code>，將參數聚合為JSON陣列或物件，新增了行內操作符 -&raquo;，是列路徑運算子 -&gt;的增強，對JSON排序做了提升，並優化了JSON的更新操作。</p>
<p><strong>4.安全和帳戶管理</strong>
MySQL 8中新增了<code>caching_sha2_password</code> 授權外掛程式、角色、密碼歷史記錄和FIPS模式支援，這些特性提高了資料庫的安全性和性能，使資料庫管理員能夠更靈活地進行帳戶管理工作。</p>
<p><strong>5.InnoDB的變化</strong>
<code>InnoDB是MySQL預設的存儲引擎</code>，是事務型資料庫的首選引擎，支援事務安全表（ACID），支持行鎖定和外鍵。在MySQL 8 版本中，InnoDB在自增、索引、加密、鎖死、共用鎖等方面做了大量的<code>改進和優化</code>，並且支援原子資料定義語言（DDL），提高了資料安全性，對事務提供更好的支援。</p>
<p><strong>6.資料字典</strong>
在之前的MySQL版本中，字典資料都存儲在中繼資料檔和非事務表中。從MySQL 8開始新增了交易資料字典，在這個字典裡存儲著資料庫物件資訊，這些資料字典存儲在內部事務表中。</p>
<p><strong>7. 原子資料定義語句</strong>
MySQL 8開始支援原子資料定義語句（Automic DDL），即<code>原子DDL</code>。目前，只有InnoDB存儲引擎支援原子DDL。原子資料定義語句（DDL）將與DDL操作相關的資料字典更新、存儲引擎操作、二進位日誌寫入結合到一個單獨的原子事務中，這使得即使伺服器崩潰，事務也會提交或回滾。
使用支援原子操作的存儲引擎所創建的表，在執行DROP TABLE、CREATE TABLE、ALTER TABLE、 RENAME TABLE、TRUNCATE TABLE、CREATE TABLESPACE、DROP TABLESPACE等操作時，都支援原子操作，即事務要麼完全操作成功，要麼失敗後回滾，不再進行部分提交。
對於從MySQL 5.7複製到MySQL 8 版本中的語句，可以添加<code>IF EXISTS</code>或<code>IF NOT EXISTS</code>語句來避免發生錯誤。</p>
<p><strong>8.資源管理</strong>
MySQL 8開始支援創建和管理資源組，允許將伺服器內運行的執行緒分配給特定的分組，以便執行緒根據組內可用資源執行。組屬性能夠控制組內資源，啟用或限制組內資源消耗。資料庫管理員能夠根據不同的工作負載適當地更改這些屬性。
目前，CPU時間是可控資源，由&quot;虛擬CPU&quot;這個概念來表示，此術語包含CPU的核心數，超執行緒，硬體執行緒等等。伺服器在啟動時確定可用的虛擬CPU數量。擁有對應許可權的資料庫管理員可以將這些CPU與資源組關聯，並為資源組分配執行緒。
資源組元件為MySQL中的資源組管理提供了SQL介面。資源組的屬性用於定義資源組。MySQL中存在兩個預設組，系統組和使用者組，預設的組不能被刪除，其屬性也不能被更改。對於用戶自訂的組，資源組創建時可初始化所有的屬性，除去名字和類型，其他屬性都可在創建之後進行更改。
在一些平臺下，或進行了某些MySQL的配置時，資源管理的功能將受到限制，甚至不可用。例如，如果安裝了執行緒池外掛程式，或者使用的是macOS系統，資源管理將處於不可用狀態。在FreeBSD和Solaris系統中，資源執行緒優先順序將失效。在Linux系統中，只有配置了CAP_SYS_NICE屬性，資源管理優先順序才能發揮作用。</p>
<p><strong>9.字元集支援</strong>
MySQL 8中預設的字元集由<code>latin1</code>更改為<code>utf8mb4</code>，並首次增加了日語所特定使用的集合，utf8mb4_ja_0900_as_cs。</p>
<p><strong>10.優化器增強</strong>
MySQL優化器開始支援隱藏索引和降冪索引。隱藏索引不會被優化器使用，驗證索引的必要性時不需要刪除索引，先將索引隱藏，如果優化器性能無影響就可以真正地刪除索引。降冪索引允許優化器對多個列進行排序，並且允許排序順序不一致。</p>
<p><strong>11.公用表運算式</strong>
公用表運算式（Common Table Expressions）簡稱為CTE，MySQL現在支持遞迴和非遞迴兩種形式的CTE。CTE通過在SELECT語句或其他特定語句前<code>使用WITH語句對臨時結果集</code>進行命名。</p>
<p>基礎語法如下：</p>
<pre tabindex="0"><code>WITH cte_name (col_name1,col_name2 ...) AS (Subquery)
SELECT * FROM cte_name;
</code></pre><p>Subquery代表子查詢，子查詢前使用WITH語句將結果集命名為cte_name，在後續的查詢中即可使用cte_name進行查詢。</p>
<p><strong>12.視窗函數</strong>
MySQL 8開始支援視窗函數。在之前的版本中已存在的大部分<code>彙總函式</code>在MySQL 8中也可以作為視窗函數來使用。</p>
<p><img src="image-20210730165317542.jpg" alt="image-20210730165317542"></p>
<p><strong>13.規則運算式支持</strong>
MySQL在8.0.4以後的版本中採用支援Unicode的國際化元件庫實現規則運算式操作，這種方式不僅能提供完全的Unicode支援，而且是多位元組安全編碼。MySQL增加了REGEXP_LIKE()、EGEXP_INSTR()、REGEXP_REPLACE()和 REGEXP_SUBSTR()等函數來提升性能。另外，regexp_stack_limit和regexp_time_limit 系統變數能夠通過匹配引擎來控制資源消耗。</p>
<p><strong>14.內部臨時表</strong>
<code>TempTable存儲引擎取代MEMORY存儲引擎成為內部臨時表的預設存儲引擎</code>。TempTable存儲引擎為VARCHAR和VARBINARY列提供高效存儲。internal_tmp_mem_storage_engine會話變數定義了內部臨時表的存儲引擎，可選的值有兩個，TempTable和MEMORY，其中TempTable為預設的存儲引擎。temptable_max_ram系統組態項定義了TempTable存儲引擎可使用的最大記憶體數量。</p>
<p><strong>15.日誌記錄</strong>
在MySQL 8中錯誤日誌子系統由一系列MySQL元件構成。這些元件的構成由系統變數log_error_services來配置，能夠實現日誌事件的過濾和寫入。</p>
<p><strong>16.備份鎖</strong>
新的備份鎖允許線上備份期間執行資料動作陳述式，同時阻止可能造成快照不一致的操作。新備份鎖由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 語法提供支援，執行這些操作需要備份管理員特權。</p>
<p><strong>17.增強的MySQL複製</strong>
MySQL 8複製支援對<code>JSON文檔</code>進行部分更新的<code>二進位日誌記錄</code>，該記錄<code>使用緊湊的二進位格式</code>，從而節省記錄完整JSON文檔的空間。當使用基於語句的日誌記錄時，這種緊湊的日誌記錄會自動完成，並且可以通過將新的binlog_row_value_options系統變數值設置為PARTIAL_JSON來啟用。</p>
<h3 id="12-mysql80移除的舊特性">1.2 MySQL8.0移除的舊特性</h3>
<p>在MySQL 5.7版本上開發的應用程式如果使用了MySQL8.0 移除的特性，語句可能會失敗，或者產生不同的執行結果。為了避免這些問題，對於使用了移除特性的應用，應當盡力修正避免使用這些特性，並盡可能使用替代方法。</p>
<p><strong>1. 查詢緩存</strong>
<code>查詢緩存已被移除</code>，刪除的項有：
**（1）語句：**FLUSH QUERY CACHE和RESET QUERY CACHE。
**（2）系統變數：**query_cache_limit、query_cache_min_res_unit、query_cache_size、query_cache_type、query_cache_wlock_invalidate。
**（3）狀態變數：**Qcache_free_blocks、Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、Qcache_queries_in_cache、Qcache_total_blocks。
**（4）執行緒狀態：**checking privileges on cached query、checking query cache for query、invalidating query cache entries、sending cached result to client、storing result in query cache、waiting for query cache lock。</p>
<p><strong>2.加密相關</strong>
刪除的加密相關的內容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT()和DES_DECRYPT()函數，配置項des-key-file，系統變數have_crypt，FLUSH語句的DES_KEY_FILE選項，HAVE_CRYPT CMake選項。
對於移除的ENCRYPT()函數，考慮使用SHA2()替代，對於其他移除的函數，使用AES_ENCRYPT()和AES_DECRYPT()替代。</p>
<p><strong>3.空間函數相關</strong>
在MySQL 5.7版本中，多個空間函數已被標記為過時。這些過時函數在MySQL 8中都已被移除，只保留了對應的ST_和MBR函數。</p>
<p><strong>4.\N和NULL</strong>
在SQL語句中，解析器不再將\N視為NULL，所以在SQL語句中應使用NULL代替\N。這項變化不會影響使用LOAD DATA INFILE或者SELECT&hellip;INTO OUTFILE操作檔的導入和匯出。在這類操作中，NULL仍等同於\N。</p>
<p><strong>5. mysql_install_db</strong>
在MySQL分佈中，已移除了mysql_install_db程式，資料字典初始化需要調用帶著&ndash;initialize或者&ndash;initialize-insecure選項的mysqld來代替實現。另外，&ndash;bootstrap和INSTALL_SCRIPTDIR CMake也已被刪除。</p>
<p><strong>6.通用分區處理常式</strong>
通用分區處理常式已從MySQL服務中被移除。為了實現給定表分區，表所使用的存儲引擎需要自有的分區處理常式。
提供本地分區支援的MySQL存儲引擎有兩個，即InnoDB和NDB，而在MySQL 8中只支持InnoDB。</p>
<p><strong>7.系統和狀態變數資訊</strong>
在INFORMATION_SCHEMA資料庫中，對系統和狀態變數資訊不再進行維護。GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS表都已被刪除。另外，系統變數show_compatibility_56也已被刪除。被刪除的狀態變數有Slave_heartbeat_period、Slave_last_heartbeat,Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被刪除的內容都可使用性能模式中對應的內容進行替代。</p>
<p><strong>8.mysql_plugin工具</strong>
mysql_plugin工具用來配置MySQL伺服器外掛程式，現已被刪除，可使用&ndash;plugin-load或&ndash;plugin-load-add選項在伺服器啟動時載入外掛程式或者在運行時使用INSTALL PLUGIN語句載入外掛程式來替代該工具。</p>
<h2 id="2-新特性1視窗函數">2. 新特性1：視窗函數</h2>
<h3 id="21-使用視窗函數前後對比">2.1 使用視窗函數前後對比</h3>
<p>假設我現在有這樣一個資料表，它顯示了某購物網站在每個城市每個區的銷售額：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">TABLE</span><span style="color:#bbb"> </span><span style="color:#008b45">sales</span>(<span style="color:#bbb">
</span><span style="color:#bbb"></span>id<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">INT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">KEY</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AUTO_INCREMENT</span>,<span style="color:#bbb">
</span><span style="color:#bbb"></span>city<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">VARCHAR</span>(<span style="color:#b452cd">15</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>county<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">VARCHAR</span>(<span style="color:#b452cd">15</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>sales_value<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">DECIMAL</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">INTO</span><span style="color:#bbb"> </span><span style="color:#008b45">sales</span>(city,county,sales_value)<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">VALUES</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#cd5555">&#39;北京&#39;</span>,<span style="color:#cd5555">&#39;海澱&#39;</span>,<span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#cd5555">&#39;北京&#39;</span>,<span style="color:#cd5555">&#39;朝陽&#39;</span>,<span style="color:#b452cd">20</span>.<span style="color:#b452cd">00</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#cd5555">&#39;上海&#39;</span>,<span style="color:#cd5555">&#39;黃埔&#39;</span>,<span style="color:#b452cd">30</span>.<span style="color:#b452cd">00</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#cd5555">&#39;上海&#39;</span>,<span style="color:#cd5555">&#39;長寧&#39;</span>,<span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span>);<span style="color:#bbb">
</span></code></pre></div><p>查詢：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sales;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+------+--------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>city<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>county<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>sales_value<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+------+--------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">海澱</span><span style="color:#bbb">    </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">朝陽</span><span style="color:#bbb">    </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">黃埔</span><span style="color:#bbb">    </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">長寧</span><span style="color:#bbb">    </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+------+--------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>**需求：**現在計算這個網站在每個城市的銷售總額、在全國的銷售總額、每個區的銷售額占所在城市銷售額中的比率，以及占總銷售額中的比率。</p>
<p>如果用分組和彙總函式，就需要分好幾步來計算。</p>
<p>第一步，計算總銷售金額，並存入臨時表 a：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">CREATE</span><span style="color:#bbb"> </span>TEMPORARY<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>a<span style="color:#bbb">       </span><span style="color:#228b22">-- 創建臨時表
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>sales_value<span style="color:#bbb"> </span><span style="color:#228b22">-- 計算總計金額
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sales;<span style="color:#bbb">
</span></code></pre></div><p>查看一下臨時表 a ：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>a;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>sales_value<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">          </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>row<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>第二步，計算每個城市的銷售總額並存入臨時表 b：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">CREATE</span><span style="color:#bbb"> </span>TEMPORARY<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>b<span style="color:#bbb">    </span><span style="color:#228b22">-- 創建臨時表
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>city,<span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>sales_value<span style="color:#bbb">  </span><span style="color:#228b22">-- 計算城市銷售合計
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sales<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>city;<span style="color:#bbb">
</span></code></pre></div><p>查看臨時表 b ：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>b;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>city<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>sales_value<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb"> </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb"> </span>|<span style="color:#bbb">          </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>第三步，計算各區的銷售占所在城市的總計金額的比例，和占全部銷售總計金額的比例。我們可以通過下面的連接查詢獲得需要的結果：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>s.city<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">城市</span>,s.county<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區</span>,s.sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區銷售額</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>b.sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市銷售額</span>,s.sales_value/b.sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市比率</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>a.sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總銷售額</span>,s.sales_value/a.sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總比率</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sales<span style="color:#bbb"> </span>s<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>b<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ON</span><span style="color:#bbb"> </span>(s.city=b.city)<span style="color:#bbb"> </span><span style="color:#228b22">-- 連接市統計結果臨時表
</span><span style="color:#228b22"></span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>a<span style="color:#bbb">                   </span><span style="color:#228b22">-- 連接總計金額臨時表
</span><span style="color:#228b22"></span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>s.city,s.county;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">城市</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區銷售額</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市銷售額</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市比率</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總銷售額</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總比率</span><span style="color:#bbb">  </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">長寧</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">1429</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">黃埔</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">7500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">4286</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">朝陽</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">6667</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2857</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">海澱</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">3333</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">1429</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>結果顯示：市銷售金額、市銷售占比、總銷售金額、總銷售占比都計算出來了。</p>
<p>同樣的查詢，如果用視窗函數，就簡單多了。我們可以用下面的代碼來實現：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>city<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">城市</span>,county<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區</span>,sales_value<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區銷售額</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>city)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市銷售額</span>,<span style="color:#bbb">  </span><span style="color:#228b22">-- 計算市銷售額
</span><span style="color:#228b22"></span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>sales_value/<span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>city)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市比率</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>()<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總銷售額</span>,<span style="color:#bbb">   </span><span style="color:#228b22">-- 計算總銷售額
</span><span style="color:#228b22"></span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>sales_value/<span style="color:#008b45">SUM</span>(sales_value)<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>()<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總比率</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sales<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>city,county;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">城市</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">區銷售額</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市銷售額</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">市比率</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總銷售額</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">總比率</span><span style="color:#bbb">  </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">長寧</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">40</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">1429</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">上海</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">黃埔</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">40</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">7500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">4286</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">朝陽</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">6667</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2857</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">北京</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">海澱</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">30</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">3333</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">1429</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+------+------+----------+-----------+--------+----------+--------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>結果顯示，我們得到了與上面那種查詢同樣的結果。</p>
<p>使用視窗函數，只用了一步就完成了查詢。而且，由於沒有用到臨時表，執行的效率也更高了。很顯然，<strong>在這種需要用到分組統計的結果對每一條記錄進行計算的場景下，使用視窗函數更好</strong>。</p>
<h3 id="22-視窗函數分類">2.2 視窗函數分類</h3>
<p>MySQL從8.0版本開始支援視窗函數。視窗函數的作用類似於在查詢中對資料進行分組，不同的是，分組操作會把分組的結果聚合成一條記錄，而視窗函數是將結果置於每一條資料記錄中。</p>
<p>視窗函數可以分為<code>靜態視窗函數</code>和<code>動態視窗函數</code>。</p>
<ul>
<li>靜態視窗函數的視窗大小是固定的，不會因為記錄的不同而不同；</li>
<li>動態視窗函數的視窗大小會隨著記錄的不同而變化。</li>
</ul>
<p>MySQL官方網站視窗函數的網址為https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html#function_row-number。</p>
<p>視窗函數總體上可以分為序號函數、分佈函數、前後函數、首尾函數和其他函數，如下表：</p>
<p><img src="image-20211012162944536.jpg" alt="image-20211012162944536"></p>
<h3 id="23-語法結構">2.3 語法結構</h3>
<p>視窗函數的語法結構是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#a61717;background-color:#e3d2d2">函數</span><span style="color:#bbb"> </span>OVER<span style="color:#a61717;background-color:#e3d2d2">（</span>[PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">欄位名</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">欄位名</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ASC</span>|<span style="color:#8b008b;font-weight:bold">DESC</span>]<span style="color:#a61717;background-color:#e3d2d2">）</span><span style="color:#bbb">
</span></code></pre></div><p>或者是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#a61717;background-color:#e3d2d2">函數</span><span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">視窗名</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">…</span><span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">視窗名</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">（</span>[PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">欄位名</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">欄位名</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ASC</span>|<span style="color:#8b008b;font-weight:bold">DESC</span>]<span style="color:#a61717;background-color:#e3d2d2">）</span><span style="color:#bbb">
</span></code></pre></div><ul>
<li>OVER 關鍵字指定函數視窗的範圍。
<ul>
<li>如果省略後面括弧中的內容，則視窗會包含滿足WHERE條件的所有記錄，視窗函數會基於所有滿足WHERE條件的記錄進行計算。</li>
<li>如果OVER關鍵字後面的括弧不為空，則可以使用如下語法設置視窗。</li>
</ul>
</li>
<li>窗口名：為視窗設置一個別名，用來標識視窗。</li>
<li>PARTITION BY子句：指定視窗函數按照哪些欄位進行分組。分組後，視窗函數可以在每個分組中分別執行。</li>
<li>ORDER BY子句：指定視窗函數按照哪些欄位進行排序。執行排序操作使視窗函數按照排序後的資料記錄的順序進行編號。</li>
<li>FRAME子句：為分區中的某個子集定義規則，可以用來作為滑動視窗使用。</li>
</ul>
<h3 id="24-分類講解">2.4 分類講解</h3>
<p>創建表：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">TABLE</span><span style="color:#bbb"> </span><span style="color:#008b45">goods</span>(<span style="color:#bbb">
</span><span style="color:#bbb"></span>id<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">INT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">KEY</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AUTO_INCREMENT</span>,<span style="color:#bbb">
</span><span style="color:#bbb"></span>category_id<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">INT</span>,<span style="color:#bbb">
</span><span style="color:#bbb"></span>category<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">VARCHAR</span>(<span style="color:#b452cd">15</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>NAME<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">VARCHAR</span>(<span style="color:#b452cd">30</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>price<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">DECIMAL</span>(<span style="color:#b452cd">10</span>,<span style="color:#b452cd">2</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>stock<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">INT</span>,<span style="color:#bbb">
</span><span style="color:#bbb"></span>upper_time<span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">DATETIME</span><span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></code></pre></div><p>添加數據：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">INSERT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">INTO</span><span style="color:#bbb"> </span><span style="color:#008b45">goods</span>(category_id,category,NAME,price,stock,upper_time)<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">VALUES</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;T恤&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1000</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;連衣裙&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">2500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;衛衣&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;牛仔褲&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">3500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;百褶裙&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">1</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;女裝/女士精品&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;呢絨外套&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1200</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;自行車&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1000</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;山地自行車&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">2500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;登山杖&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;騎行裝備&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">3500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;運動外套&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">500</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>),<span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#b452cd">2</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;戶外運動&#39;</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;滑板&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span>,<span style="color:#bbb"> </span><span style="color:#b452cd">1200</span>,<span style="color:#bbb"> </span><span style="color:#cd5555">&#39;2020-11-10 00:00:00&#39;</span>);<span style="color:#bbb">
</span></code></pre></div><p>下面針對goods表中的資料來驗證每個視窗函數的功能。</p>
<h4 id="1-序號函數">1. 序號函數</h4>
<p><strong>1．ROW_NUMBER()函數</strong></p>
<p>ROW_NUMBER()函數能夠對資料中的序號進行順序顯示。</p>
<p>舉例：查詢 goods 資料表中每個商品分類下價格降冪排列的各個商品資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">ROW_NUMBER</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>row_num,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+---------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+---------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">        </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+---------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>舉例：查詢 goods 資料表中每個商品分類下價格最高的3種商品資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">ROW_NUMBER</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>row_num,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods)<span style="color:#bbb"> </span>t<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>&lt;=<span style="color:#bbb"> </span><span style="color:#b452cd">3</span>;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+---------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+---------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">        </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+------------+----------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>在名稱為&quot;女裝/女士精品&quot;的商品類別中，有兩款商品的價格為89.90元，分別是衛衣和牛仔褲。兩款商品的序號都應該為2，而不是一個為2，另一個為3。此時，可以使用RANK()函數和DENSE_RANK()函數解決。</p>
<p><strong>2．RANK()函數</strong></p>
<p>使用RANK()函數能夠對序號進行並列排序，並且會跳過重複的序號，比如序號為1、1、3。</p>
<p>舉例：使用RANK()函數獲取 goods 資料表中各類別的價格從高到低排序的各商品資訊。</p>
<pre tabindex="0"><code>mysql&gt; SELECT RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,
    -&gt; id, category_id, category, NAME, price, stock
    -&gt; FROM goods;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category      | NAME       | price   | stock |
+---------+----+-------------+---------------+------------+---------+-------+
|       1 |  6 |           1 | 女裝/女士精品   | 呢絨外套    |  399.90 |  1200 |
|       2 |  3 |           1 | 女裝/女士精品   | 衛衣        |   89.90 |  1500 |
|       2 |  4 |           1 | 女裝/女士精品   | 牛仔褲      |   89.90 |  3500 |
|       4 |  2 |           1 | 女裝/女士精品   | 連衣裙      |   79.90 |  2500 |
|       5 |  1 |           1 | 女裝/女士精品   | T恤         |   39.90 |  1000 |
|       6 |  5 |           1 | 女裝/女士精品   | 百褶裙      |   29.90 |   500 |
|       1 |  8 |           2 | 戶外運動       | 山地自行車   | 1399.90 |  2500 |
|       2 | 11 |           2 | 戶外運動       | 運動外套     |  799.90 |   500 |
|       3 | 12 |           2 | 戶外運動       | 滑板        |  499.90 |  1200 |
|       4 |  7 |           2 | 戶外運動       | 自行車      |  399.90 |  1000 |
|       4 | 10 |           2 | 戶外運動       | 騎行裝備    |  399.90 |  3500 |
|       6 |  9 |           2 | 戶外運動       | 登山杖      |   59.90 |  1500 |
+---------+----+-------------+---------------+------------+---------+-------+
12 rows in set (0.00 sec)
</code></pre><p>舉例：使用RANK()函數獲取 goods 資料表中類別為&quot;女裝/女士精品&quot;的價格最高的4款商品資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">RANK</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>row_num,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods)<span style="color:#bbb"> </span>t<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AND</span><span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>&lt;=<span style="color:#bbb"> </span><span style="color:#b452cd">4</span>;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">     </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>可以看到，使用RANK()函數得出的序號為1、2、2、4，相同價格的商品序號相同，後面的商品序號是不連續的，跳過了重複的序號。</p>
<p><strong>3．DENSE_RANK()函數</strong></p>
<p>DENSE_RANK()函數對序號進行並列排序，並且不會跳過重複的序號，比如序號為1、1、2。</p>
<p>舉例：使用DENSE_RANK()函數獲取 goods 資料表中各類別的價格從高到低排序的各商品資訊。</p>
<pre tabindex="0"><code>mysql&gt; SELECT DENSE_RANK() OVER(PARTITION BY category_id ORDER BY price DESC) AS row_num,
    -&gt; id, category_id, category, NAME, price, stock
    -&gt; FROM goods;
+---------+----+-------------+---------------+------------+---------+-------+
| row_num | id | category_id | category      | NAME       | price   | stock |
+---------+----+-------------+---------------+------------+---------+-------+
|       1 |  6 |           1 | 女裝/女士精品   | 呢絨外套    |  399.90 |  1200 |
|       2 |  3 |           1 | 女裝/女士精品   | 衛衣        |   89.90 |  1500 |
|       2 |  4 |           1 | 女裝/女士精品   | 牛仔褲      |   89.90 |  3500 |
|       3 |  2 |           1 | 女裝/女士精品   | 連衣裙      |   79.90 |  2500 |
|       4 |  1 |           1 | 女裝/女士精品   | T恤        |   39.90 |  1000 |
|       5 |  5 |           1 | 女裝/女士精品   | 百褶裙      |   29.90 |   500 |
|       1 |  8 |           2 | 戶外運動       | 山地自行車   | 1399.90 |  2500 |
|       2 | 11 |           2 | 戶外運動       | 運動外套     |  799.90 |   500 |
|       3 | 12 |           2 | 戶外運動       | 滑板        |  499.90 |  1200 |
|       4 |  7 |           2 | 戶外運動       | 自行車       |  399.90 |  1000 |
|       4 | 10 |           2 | 戶外運動       | 騎行裝備     |  399.90 |  3500 |
|       5 |  9 |           2 | 戶外運動       | 登山杖       |   59.90 |  1500 |
+---------+----+-------------+---------------+------------+---------+-------+
12 rows in set (0.00 sec)
</code></pre><p>舉例：使用DENSE_RANK()函數獲取 goods 資料表中類別為&quot;女裝/女士精品&quot;的價格最高的4款商品資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">DENSE_RANK</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>row_num,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods)<span style="color:#bbb"> </span>t<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AND</span><span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>&lt;=<span style="color:#bbb"> </span><span style="color:#b452cd">3</span>;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>row_num<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">     </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">       </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>可以看到，使用DENSE_RANK()函數得出的行號為1、2、2、3，相同價格的商品序號相同，後面的商品序號是連續的，並且沒有跳過重複的序號。</p>
<h4 id="2-分佈函數">2. 分佈函數</h4>
<p><strong>1．PERCENT_RANK()函數</strong></p>
<p>PERCENT_RANK()函數是等級值百分比函數。按照如下方式進行計算。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#bbb"> </span>(rank<span style="color:#bbb"> </span>-<span style="color:#bbb"> </span><span style="color:#b452cd">1</span>)<span style="color:#bbb"> </span>/<span style="color:#bbb"> </span>(rows<span style="color:#bbb"> </span>-<span style="color:#bbb"> </span><span style="color:#b452cd">1</span>)<span style="color:#bbb">
</span></code></pre></div><p>其中，rank的值為使用RANK()函數產生的序號，rows的值為當前視窗的總記錄數。</p>
<p>舉例：計算 goods 資料表中名稱為&quot;女裝/女士精品&quot;的類別下的商品的PERCENT_RANK值。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#228b22">#寫法一：
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">RANK</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>r,<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008b45">PERCENT_RANK</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>pr,<span style="color:#bbb">
</span><span style="color:#bbb"></span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">1</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#228b22">#寫法二：
</span><span style="color:#228b22"></span>mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">RANK</span>()<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>r,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#008b45">PERCENT_RANK</span>()<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>pr,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category_id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DESC</span>);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---+-----+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>r<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>pr<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">     </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---+-----+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">0</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb">  </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb">  </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb">  </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---+-----+----+-------------+---------------+----------+--------+-------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p><strong>2．CUME_DIST()函數</strong></p>
<p>CUME_DIST()函數主要用於查詢小於或等於某個值的比例。</p>
<p>舉例：查詢goods資料表中小於或等於當前價格的比例。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">CUME_DIST</span>()<span style="color:#bbb"> </span><span style="color:#008b45">OVER</span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ASC</span>)<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>cd,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------------+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>cd<span style="color:#bbb">                  </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------------+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">16666666666666666</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">3333333333333333</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">                 </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">8333333333333334</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">8333333333333334</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">                   </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">16666666666666666</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">                 </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">                 </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">6666666666666666</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">        </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">8333333333333334</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">                   </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------------+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><h4 id="3-前後函數">3. 前後函數</h4>
<p><strong>1．LAG(expr,n)函數</strong></p>
<p>LAG(expr,n)函數返回當前行的前n行的expr的值。</p>
<p>舉例：查詢goods資料表中前一個商品價格與當前商品價格的差值。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>pre_price,<span style="color:#bbb"> </span>price<span style="color:#bbb"> </span>-<span style="color:#bbb"> </span>pre_price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>diff_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb">  </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#008b45">LAG</span>(price,<span style="color:#b452cd">1</span>)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>pre_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price))<span style="color:#bbb"> </span>t;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-----------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>pre_price<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>diff_price<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-----------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">40</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">310</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">340</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">       </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">100</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">300</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">600</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-----------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p><strong>2．LEAD(expr,n)函數</strong></p>
<p>LEAD(expr,n)函數返回當前行的後n行的expr的值。</p>
<p>舉例：查詢goods資料表中後一個商品價格與當前商品價格的差值。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>behind_price,<span style="color:#bbb"> </span>price,behind_price<span style="color:#bbb"> </span>-<span style="color:#bbb"> </span>price<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>diff_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#008b45">LEAD</span>(price,<span style="color:#bbb"> </span><span style="color:#b452cd">1</span>)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>behind_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price))<span style="color:#bbb"> </span>t;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+--------------+---------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>behind_price<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>diff_price<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+--------------+---------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">40</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">10</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">310</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">     </span>|<span style="color:#bbb">         </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">       </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">340</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">       </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">     </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">100</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">        </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">300</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">     </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">600</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">   </span>|<span style="color:#bbb">         </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+--------------+---------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><h4 id="4-首尾函數">4. 首尾函數</h4>
<p><strong>1．FIRST_VALUE(expr)函數</strong></p>
<p>FIRST_VALUE(expr)函數返回第一個expr的值。</p>
<p>舉例：按照價格排序，查詢第1個商品的價格資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock,<span style="color:#008b45">FIRST_VALUE</span>(price)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>first_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>first_price<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">      </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">      </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">       </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">    </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb">  </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p><strong>2．LAST_VALUE(expr)函數</strong></p>
<p>LAST_VALUE(expr)函數返回最後一個expr的值。</p>
<p>舉例：按照價格排序，查詢最後一個商品的價格資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#bbb"> </span>stock,<span style="color:#008b45">LAST_VALUE</span>(price)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>last_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>stock<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>last_price<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1000</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">       </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">     </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">    </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+-------+------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><h4 id="5-其他函數">5. 其他函數</h4>
<p><strong>1．NTH_VALUE(expr,n)函數</strong></p>
<p>NTH_VALUE(expr,n)函數返回第n個expr的值。</p>
<p>舉例：查詢goods資料表中排名第2和第3的價格資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price,<span style="color:#008b45">NTH_VALUE</span>(price,<span style="color:#b452cd">2</span>)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>second_price,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#008b45">NTH_VALUE</span>(price,<span style="color:#b452cd">3</span>)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>third_price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+--------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>second_price<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>third_price<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+--------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">         </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb">   </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">         </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#00688b">NULL</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">       </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">       </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">       </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">      </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+---------------+------------+---------+--------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p><strong>2．NTILE(n)函數</strong></p>
<p>NTILE(n)函數將分區中的有序數據分為n個桶，記錄桶編號。</p>
<p>舉例：將goods表中的商品按照價格分為3組。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#008b45">NTILE</span>(<span style="color:#b452cd">3</span>)<span style="color:#bbb"> </span>OVER<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>nt,id,<span style="color:#bbb"> </span>category,<span style="color:#bbb"> </span>NAME,<span style="color:#bbb"> </span>price<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>goods<span style="color:#bbb"> </span>WINDOW<span style="color:#bbb"> </span>w<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(PARTITION<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>category_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">BY</span><span style="color:#bbb"> </span>price);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>nt<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>category<span style="color:#bbb">      </span>|<span style="color:#bbb"> </span>NAME<span style="color:#bbb">       </span>|<span style="color:#bbb"> </span>price<span style="color:#bbb">   </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">5</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">百褶裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">29</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>T恤<span style="color:#bbb">        </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">39</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">連衣裙</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">79</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">衛衣</span><span style="color:#bbb">       </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">4</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">牛仔褲</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">89</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">6</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">女裝</span>/<span style="color:#a61717;background-color:#e3d2d2">女士精品</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">呢絨外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">9</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">登山杖</span><span style="color:#bbb">     </span>|<span style="color:#bbb">   </span><span style="color:#b452cd">59</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">1</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">7</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">自行車</span><span style="color:#bbb">     </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">騎行裝備</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">2</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">滑板</span><span style="color:#bbb">       </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">499</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">運動外套</span><span style="color:#bbb">   </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">799</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">  </span><span style="color:#b452cd">3</span><span style="color:#bbb"> </span>|<span style="color:#bbb">  </span><span style="color:#b452cd">8</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">戶外運動</span><span style="color:#bbb">      </span>|<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">山地自行車</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span><span style="color:#b452cd">1399</span>.<span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+----+----+---------------+------------+---------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">12</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><h3 id="25-小-結">2.5 小 結</h3>
<p>視窗函數的特點是可以分組，而且可以在分組內排序。另外，視窗函數不會因為分組而減少原表中的行數，這對我們在原表資料的基礎上進行統計和排序非常有用。</p>
<h2 id="3-新特性2公用表運算式">3. 新特性2：公用表運算式</h2>
<p>公用表運算式（或通用表運算式）簡稱為CTE（Common Table Expressions）。CTE是一個命名的臨時結果集，作用範圍是當前語句。CTE可以理解成一個可以複用的子查詢，當然跟子查詢還是有點區別的，CTE可以引用其他CTE，但子查詢不能引用其他子查詢。所以，可以考慮代替子查詢。</p>
<p>依據語法結構和執行方式的不同，公用表運算式分為<code>普通公用表運算式</code>和<code>遞迴公用表運算式</code> 2 種。</p>
<h3 id="31-普通公用表運算式">3.1 普通公用表運算式</h3>
<p>普通公用表運算式的語法結構是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">WITH</span><span style="color:#bbb"> </span>CTE名稱<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">（子查詢）</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">SELECT</span>|<span style="color:#8b008b;font-weight:bold">DELETE</span>|<span style="color:#8b008b;font-weight:bold">UPDATE</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">語句</span>;<span style="color:#bbb">
</span></code></pre></div><p>普通公用表運算式類似於子查詢，不過，跟子查詢不同的是，它可以被多次引用，而且可以被其他的普通公用表運算式所引用。</p>
<p>舉例：查詢員工所在的部門的詳細資訊。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>departments<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>department_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">IN</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">                  </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DISTINCT</span><span style="color:#bbb"> </span>department_id<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">                  </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>employees<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb">                  </span>);<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>department_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>department_name<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>manager_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>location_id<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Administration<span style="color:#bbb">   </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Marketing<span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">201</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1800</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Purchasing<span style="color:#bbb">       </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">114</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Human<span style="color:#bbb"> </span>Resources<span style="color:#bbb">  </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">203</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2400</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">50</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Shipping<span style="color:#bbb">         </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">121</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">60</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>IT<span style="color:#bbb">               </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">103</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1400</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Public<span style="color:#bbb"> </span>Relations<span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">204</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">80</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Sales<span style="color:#bbb">            </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">145</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Executive<span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">           </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Finance<span style="color:#bbb">          </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">108</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">           </span><span style="color:#b452cd">110</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Accounting<span style="color:#bbb">       </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">205</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>這個查詢也可以用普通公用表運算式的方式完成：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WITH</span><span style="color:#bbb"> </span>emp_dept_id<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">DISTINCT</span><span style="color:#bbb"> </span>department_id<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>employees)<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>*<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>departments<span style="color:#bbb"> </span>d<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>emp_dept_id<span style="color:#bbb"> </span>e<span style="color:#bbb">
</span><span style="color:#bbb">    </span>-&gt;<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ON</span><span style="color:#bbb"> </span>d.department_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>e.department_id;<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+---------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb"> </span>department_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>department_name<span style="color:#bbb">  </span>|<span style="color:#bbb"> </span>manager_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>location_id<span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>department_id<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+---------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Executive<span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">90</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">60</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>IT<span style="color:#bbb">               </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">103</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1400</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">60</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">           </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Finance<span style="color:#bbb">          </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">108</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Purchasing<span style="color:#bbb">       </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">114</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">30</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">50</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Shipping<span style="color:#bbb">         </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">121</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">50</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">80</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Sales<span style="color:#bbb">            </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">145</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2500</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">80</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Administration<span style="color:#bbb">   </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">200</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">10</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Marketing<span style="color:#bbb">        </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">201</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1800</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">20</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Human<span style="color:#bbb"> </span>Resources<span style="color:#bbb">  </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">203</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2400</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">40</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">            </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Public<span style="color:#bbb"> </span>Relations<span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">204</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">2700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">            </span><span style="color:#b452cd">70</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>|<span style="color:#bbb">           </span><span style="color:#b452cd">110</span><span style="color:#bbb"> </span>|<span style="color:#bbb"> </span>Accounting<span style="color:#bbb">       </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">205</span><span style="color:#bbb"> </span>|<span style="color:#bbb">        </span><span style="color:#b452cd">1700</span><span style="color:#bbb"> </span>|<span style="color:#bbb">           </span><span style="color:#b452cd">110</span><span style="color:#bbb"> </span>|<span style="color:#bbb">
</span><span style="color:#bbb"></span>+---------------+------------------+------------+-------------+---------------+<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#b452cd">11</span><span style="color:#bbb"> </span>rows<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">in</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">set</span><span style="color:#bbb"> </span>(<span style="color:#b452cd">0</span>.<span style="color:#b452cd">00</span><span style="color:#bbb"> </span>sec)<span style="color:#bbb">
</span></code></pre></div><p>例子說明，公用表運算式可以起到子查詢的作用。以後如果遇到需要使用子查詢的場景，你可以在查詢之前，先定義公用表運算式，然後在查詢中用它來代替子查詢。而且，跟子查詢相比，公用表運算式有一個優點，就是定義過公用表運算式之後的查詢，可以像一個表一樣多次引用公用表運算式，而子查詢則不能。</p>
<h3 id="32-遞迴公用表運算式">3.2 遞迴公用表運算式</h3>
<p>遞迴公用表運算式也是一種公用表運算式，只不過，除了普通公用表運算式的特點以外，它還有自己的特點，就是<strong>可以調用自己</strong>。它的語法結構是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">WITH</span><span style="color:#bbb"> </span>RECURSIVE<span style="color:#bbb">
</span><span style="color:#bbb"></span>CTE名稱<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">（子查詢）</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">SELECT</span>|<span style="color:#8b008b;font-weight:bold">DELETE</span>|<span style="color:#8b008b;font-weight:bold">UPDATE</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">語句</span>;<span style="color:#bbb">
</span></code></pre></div><p>遞迴公用表運算式由 2 部分組成，分別是種子查詢和遞迴查詢，中間通過關鍵字 UNION  [ALL]進行連接。這裡的<strong>種子查詢，意思就是獲得遞迴的初始值</strong>。這個查詢只會運行一次，以創建初始資料集，之後遞迴查詢會一直執行，直到沒有任何新的查詢資料產生，遞迴返回。</p>
<p>**案例：**針對於我們常用的employees表，包含employee_id，last_name和manager_id三個欄位。如果a是b的管理者，那麼，我們可以把b叫做a的下屬，如果同時b又是c的管理者，那麼c就是b的下屬，是a的下下屬。</p>
<p>下面我們嘗試用查詢語句列出所有具有下下屬身份的人員資訊。</p>
<p>如果用我們之前學過的知識來解決，會比較複雜，至少要進行 4 次查詢才能搞定：</p>
<ul>
<li>
<p>第一步，先找出初代管理者，就是不以任何別人為管理者的人，把結果存入臨時表；</p>
</li>
<li>
<p>第二步，找出所有以初代管理者為管理者的人，得到一個下屬集，把結果存入臨時表；</p>
</li>
<li>
<p>第三步，找出所有以下屬為管理者的人，得到一個下下屬集，把結果存入臨時表。</p>
</li>
<li>
<p>第四步，找出所有以下下屬為管理者的人，得到一個結果集。</p>
</li>
</ul>
<p>如果第四步的結果集為空，則計算結束，第三步的結果集就是我們需要的下下屬集了，否則就必須繼續進行第四步，一直到結果集為空為止。比如上面的這個資料表，就需要到第五步，才能得到空結果集。而且，最後還要進行第六步：把第三步和第四步的結果集合並，這樣才能最終獲得我們需要的結果集。</p>
<p>如果用遞迴公用表運算式，就非常簡單了。我介紹下具體的思路。</p>
<ul>
<li>
<p>用遞迴公用表運算式中的種子查詢，找出初代管理者。欄位 n 表示代次，初始值為 1，表示是第一代管理者。</p>
</li>
<li>
<p>用遞迴公用表運算式中的遞迴查詢，查出以這個遞迴公用表運算式中的人為管理者的人，並且代次的值加 1。直到沒有人以這個遞迴公用表運算式中的人為管理者了，遞迴返回。</p>
</li>
<li>
<p>在最後的查詢中，選出所有代次大於等於 3 的人，他們肯定是第三代及以上代次的下屬了，也就是下下屬了。這樣就得到了我們需要的結果集。</p>
</li>
</ul>
<p>這裡看似也是 3 步，實際上是一個查詢的 3 個部分，只需要執行一次就可以了。而且也不需要用臨時表保存中間結果，比剛剛的方法簡單多了。</p>
<p><strong>代碼實現：</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#8b008b;font-weight:bold">WITH</span><span style="color:#bbb"> </span>RECURSIVE<span style="color:#bbb"> </span>cte<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>(<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>employee_id,last_name,manager_id,<span style="color:#b452cd">1</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>n<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>employees<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>employee_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span><span style="color:#b452cd">100</span><span style="color:#bbb"> </span><span style="color:#228b22">-- 種子查詢，找到第一代領導
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">ALL</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>a.employee_id,a.last_name,a.manager_id,n+<span style="color:#b452cd">1</span><span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>employees<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">AS</span><span style="color:#bbb"> </span>a<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">JOIN</span><span style="color:#bbb"> </span>cte<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">ON</span><span style="color:#bbb"> </span>(a.manager_id<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>cte.employee_id)<span style="color:#bbb"> </span><span style="color:#228b22">-- 遞迴查詢，找出以遞迴公用表運算式的人為領導的人
</span><span style="color:#228b22"></span>)<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#8b008b;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>employee_id,last_name<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">FROM</span><span style="color:#bbb"> </span>cte<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>n<span style="color:#bbb"> </span>&gt;=<span style="color:#bbb"> </span><span style="color:#b452cd">3</span>;<span style="color:#bbb">
</span></code></pre></div><p>總之，遞迴公用表運算式對於查詢一個有共同的根節點的樹形結構資料，非常有用。它可以不受層級的限制，輕鬆查出所有節點的資料。如果用其他的查詢方式，就比較複雜了。</p>
<h3 id="33-小-結">3.3 小 結</h3>
<p>公用表運算式的作用是可以替代子查詢，而且可以被多次引用。遞迴公用表運算式對查詢有一個共同根節點的樹形結構資料非常高效，可以輕鬆搞定其他查詢方式難以處理的查詢。</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">上次修改於 2021-12-29</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/211229-agg-jdbc-01/">
			下一篇<br>JDBC基礎、PreparedStatement增刪改查
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/211228-agg-mysql-13/">
			上一篇<br>觸發器Trigger
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
