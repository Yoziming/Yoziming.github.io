<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>FilterÈÅéÊøæÂô®„ÄÅThreadLocal</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Â∞öÁ°ÖË∞∑JavaWebÁ≠ÜË®ò-10">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="FilterÈÅéÊøæÂô®„ÄÅThreadLocal" />
<meta property="og:description" content="Â∞öÁ°ÖË∞∑JavaWebÁ≠ÜË®ò-10" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220110-agg-javaweb-10/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-10T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FilterÈÅéÊøæÂô®„ÄÅThreadLocal"/>
<meta name="twitter:description" content="Â∞öÁ°ÖË∞∑JavaWebÁ≠ÜË®ò-10"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            ÊüöÂ≠êËå∂ÂÆ§
        </div>
        
        <div class="nav-subtitle">
            Á¥ÄÈåÑËá™Â≠∏Â§ßÂ∞è‰∫ã
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                È¶ñÈ†Åüè†
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Á≥ªÂàóÊñáüìñ
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Ê®ôÁ±§üè∑Ô∏è
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                ÈóúÊñºÊàëüê£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ÁßªÊ§çËá™ <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ÁõÆÈåÑ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filter%e9%81%8e%e6%bf%be%e5%99%a8" onclick="onNavClick(`#filterÈÅéÊøæÂô®-nav`)" id="filterÈÅéÊøæÂô®-nav">
									FilterÈÅéÊøæÂô®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%b9%e6%b3%95" onclick="onNavClick(`#ÊñπÊ≥ï-nav`)" id="ÊñπÊ≥ï-nav">
									ÊñπÊ≥ï
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%94%9f%e5%91%bd%e9%80%b1%e6%9c%9f" onclick="onNavClick(`#ÁîüÂëΩÈÄ±Êúü-nav`)" id="ÁîüÂëΩÈÄ±Êúü-nav">
									ÁîüÂëΩÈÄ±Êúü
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filterconfig" onclick="onNavClick(`#filterconfig-nav`)" id="filterconfig-nav">
									FilterConfig
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filterchain" onclick="onNavClick(`#filterchain-nav`)" id="filterchain-nav">
									FilterChain
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%af%a6%e4%bd%9c" onclick="onNavClick(`#ÂØ¶‰Ωú-nav`)" id="ÂØ¶‰Ωú-nav">
									ÂØ¶‰Ωú
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#webxml" onclick="onNavClick(`#webxml-nav`)" id="webxml-nav">
									web.xml
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%b9%e9%85%8d%e8%a6%8f%e5%89%87" onclick="onNavClick(`#ÂåπÈÖçË¶èÂâá-nav`)" id="ÂåπÈÖçË¶èÂâá-nav">
									ÂåπÈÖçË¶èÂâá
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3" onclick="onNavClick(`#Ë®ªËß£-nav`)" id="Ë®ªËß£-nav">
									Ë®ªËß£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%87%89%e7%94%a8%e8%87%b3%e6%9b%b8%e5%9f%8e%e9%a0%85%e7%9b%ae" onclick="onNavClick(`#ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ-nav`)" id="ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ-nav">
									ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#threadlocal" onclick="onNavClick(`#threadlocal-nav`)" id="threadlocal-nav">
									ThreadLocal
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#‰ΩøÁî®-nav`)" id="‰ΩøÁî®-nav">
									‰ΩøÁî®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%af%84%e4%be%8b" onclick="onNavClick(`#ÁØÑ‰æã-nav`)" id="ÁØÑ‰æã-nav">
									ÁØÑ‰æã
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tomcat%e9%8c%af%e8%aa%a4%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#tomcatÈåØË™§È†ÅÈù¢-nav`)" id="tomcatÈåØË™§È†ÅÈù¢-nav">
									TomcatÈåØË™§È†ÅÈù¢
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    È¶ñÈ†Åüè†
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Á≥ªÂàóÊñáüìñ
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Ê®ôÁ±§üè∑Ô∏è
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    ÈóúÊñºÊàëüê£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ÁõÆÈåÑ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filter%e9%81%8e%e6%bf%be%e5%99%a8" onclick="onNavClick(`#filterÈÅéÊøæÂô®-nav`)" id="filterÈÅéÊøæÂô®-nav">
									FilterÈÅéÊøæÂô®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%96%b9%e6%b3%95" onclick="onNavClick(`#ÊñπÊ≥ï-nav`)" id="ÊñπÊ≥ï-nav">
									ÊñπÊ≥ï
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%94%9f%e5%91%bd%e9%80%b1%e6%9c%9f" onclick="onNavClick(`#ÁîüÂëΩÈÄ±Êúü-nav`)" id="ÁîüÂëΩÈÄ±Êúü-nav">
									ÁîüÂëΩÈÄ±Êúü
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filterconfig" onclick="onNavClick(`#filterconfig-nav`)" id="filterconfig-nav">
									FilterConfig
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filterchain" onclick="onNavClick(`#filterchain-nav`)" id="filterchain-nav">
									FilterChain
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%af%a6%e4%bd%9c" onclick="onNavClick(`#ÂØ¶‰Ωú-nav`)" id="ÂØ¶‰Ωú-nav">
									ÂØ¶‰Ωú
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#webxml" onclick="onNavClick(`#webxml-nav`)" id="webxml-nav">
									web.xml
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%b9%e9%85%8d%e8%a6%8f%e5%89%87" onclick="onNavClick(`#ÂåπÈÖçË¶èÂâá-nav`)" id="ÂåπÈÖçË¶èÂâá-nav">
									ÂåπÈÖçË¶èÂâá
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3" onclick="onNavClick(`#Ë®ªËß£-nav`)" id="Ë®ªËß£-nav">
									Ë®ªËß£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%87%89%e7%94%a8%e8%87%b3%e6%9b%b8%e5%9f%8e%e9%a0%85%e7%9b%ae" onclick="onNavClick(`#ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ-nav`)" id="ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ-nav">
									ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#threadlocal" onclick="onNavClick(`#threadlocal-nav`)" id="threadlocal-nav">
									ThreadLocal
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#‰ΩøÁî®-nav`)" id="‰ΩøÁî®-nav">
									‰ΩøÁî®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%af%84%e4%be%8b" onclick="onNavClick(`#ÁØÑ‰æã-nav`)" id="ÁØÑ‰æã-nav">
									ÁØÑ‰æã
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#tomcat%e9%8c%af%e8%aa%a4%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#tomcatÈåØË™§È†ÅÈù¢-nav`)" id="tomcatÈåØË™§È†ÅÈù¢-nav">
									TomcatÈåØË™§È†ÅÈù¢
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            ÊüöÂ≠êËå∂ÂÆ§
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">ÊüöÂ≠êËå∂ÂÆ§</div>
        
        <div class="single-column-header-subtitle">Á¥ÄÈåÑËá™Â≠∏Â§ßÂ∞è‰∫ã</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/javaweb.jpg')"
                    
                
            >
                <div class="post-title">
                    FilterÈÅéÊøæÂô®„ÄÅThreadLocal
                    
                    <div class="post-subtitle">
                        Â∞öÁ°ÖË∞∑JavaWebÁ≠ÜË®ò-10
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-01-10 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/javaweb%E7%B7%9A%E4%B8%8A%E8%AA%B2">JavaWebÁ∑ö‰∏äË™≤</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="filterÈÅéÊøæÂô®">FilterÈÅéÊøæÂô®</h1>
<blockquote>
<p>Áî®‰æÜ‰øÆÈ£æË´ãÊ±ÇÊàñÈüøÊáâ</p>
</blockquote>
<ul>
<li>
<p>Âú®WebË≥áÊ∫êË¢´Ë®™ÂïèÂâçÔºåÊ™¢Êü•requestÁâ©‰ª∂Ôºå‰øÆÊîπË´ãÊ±ÇÈ†≠ÂíåË´ãÊ±ÇÊ≠£ÊñáÔºåÊàñÂ∞çË´ãÊ±ÇÈÄ≤Ë°åÈ†êËôïÁêÜÊìç‰Ωú</p>
</li>
<li>
<p>Â∞áË´ãÊ±ÇÂÇ≥ÈÅûÂà∞‰∏ã‰∏ÄÂÄãÈÅéÊøæÂô®ÊàñÁõÆÊ®ôË≥áÊ∫ê</p>
</li>
<li>
<p>Âú®WebË≥áÊ∫êË¢´Ë®™ÂïèÂæåÔºåÊ™¢Êü•responseÁâ©‰ª∂Ôºå‰øÆÊîπÂõûÊáâÈ†≠ÂíåÂõûÊáâÊ≠£Êñá</p>
</li>
<li>
<p>Â∏∏Áî®‰æÜÂÅöÊ¨äÈôêÊéßÁÆ°„ÄÅË®≠ÂÆöÁµ±‰∏ÄÁ∑®Á¢ºÁ≠âÁ≠â</p>
</li>
</ul>
<h2 id="ÊñπÊ≥ï">ÊñπÊ≥ï</h2>
<blockquote>
<p>FilterÈÉΩÊòØÊé•Âè£ÔºåÁî®Ëµ∑‰æÜË∑üservlet‰∏ÄÊ®£ÈúÄË¶ÅÂØ¶ÁèæÊñπÊ≥ï</p>
<p>ÂâçÈù¢ÈÉΩÊòØÂÅ∑ÈõûÈÄ†‰∏ÄÂÄãbaseÂéªÂØ¶ÁèæÂü∫Êú¨ÁöÑÊñπÊ≥ïÁÑ∂ÂæåÁπºÊâø</p>
</blockquote>
<ul>
<li>
<p><code>init (FilterConfig filterConfig)</code>:ÂàùÂßãÂåñÔºåÁî±webÂÆπÂô®Ë™øÁî®</p>
</li>
<li>
<p><code>doFilter(ServletRequest request,SeivletResponse response, FilterChain chain)</code>:‰∏ªË¶ÅÊñπÊ≥ïÔºåÂú®ÈÄôÈÇäÂ∞çreqÊàñrespÊØõÊâãÊØõËÖ≥ÔºåÊàñÊòØ<code>chain.doFilter</code>ÂÜçÂÇ≥Âà∞‰∏ã‰∏ÄÂÄãÈÅéÊøæÂô®</p>
</li>
<li>
<p><code>destroy()</code>:ÈáãÊîæË¢´ÈÄôÂÄãfilterÁâ©‰ª∂Âç†Áî®ÁöÑË≥áÊ∫êÔºåÁî±webÂÆπÂô®Ë™øÁî®</p>
</li>
</ul>
<h2 id="ÁîüÂëΩÈÄ±Êúü">ÁîüÂëΩÈÄ±Êúü</h2>
<ul>
<li>ÊßãÈÄ†„ÄÅ<code>init()</code>:Ë∑üÈö®webÂ∑•Á®ãËÄåÂïüÂãïÔºåË¢´Âü∑Ë°å‰∏ÄÊ¨°</li>
<li><code>doFilter()</code>:Âú®ÊØèÊ¨°ÊîîÊà™Ë´ãÊ±ÇÈÉΩË™øÁî®</li>
<li><code>destrory()</code>:Ë∑üÈö®webÂ∑•Á®ãÁµêÊùüËÄåÊ∂à‰∫°Ôºå‰πüÂè™Âü∑Ë°å‰∏ÄÊ¨°</li>
</ul>
<h2 id="filterconfig">FilterConfig</h2>
<blockquote>
<p>Ë∑üServletÂü∫Êú¨‰∏ÄÊ®£</p>
</blockquote>
<ul>
<li>
<p>ÊØèÂÄãFilterÈÉΩÊúâËá™Â∑±‰º¥ÁîüÁöÑFilterConfigÂØ¶‰æãÁâ©‰ª∂ÔºåÁï∂webÂÆπÂô®ÂïüÂãïÊôÇ‰∏Ä‰ΩµË¢´ÂâµÈÄ†Âá∫‰æÜÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∫ÜÂÆÉFilterÁöÑË®äÊÅØ</p>
</li>
<li>
<p><code>filterconfig.getFilterName()</code>:</p>
</li>
<li>
<p><code>filterconfig.getInitParameter()</code>:ÂèñÂæóÂàùÂßãÂèÉÊï∏(‰æãÂ¶ÇÂØ´Âú®web.xml‰∏≠ÁöÑ<code>&lt;init-param&gt;</code></p>
</li>
<li>
<p><code>filterconfig.getServletContext()</code>:‰πüËÉΩÁç≤Âæó<code>ServletContext</code></p>
<ul>
<li>Ë®ò‰ΩèÂèñÂá∫ÁöÑ<code>ServletContext context</code>ÊòØÊï¥ÂÄãwebÂ∑•Á®ãÂÖ±Áî®ÁöÑÂîØ‰∏Ä‰∏ÄÂÄã</li>
<li>Ë§áÁøí:ÂèØ‰ª•Áî®‰æÜÂæûurlÁ∂≤ÂùÄÂèñÂà∞Â∞çÊáâÁöÑÁ°¨Á¢üË∑ØÂæëÔºå ‰æãÂ¶Ç<code>context.getRealPath(&quot;/&quot;)</code></li>
<li>‰πüÂèØ‰ª•Áï∂mapÁî®Â≠ò<code>setAttribute</code>ÔºåËàáÂèñ<code>getAttribute</code></li>
</ul>
</li>
</ul>
<h2 id="filterchain">FilterChain</h2>
<ul>
<li>‰∏≤ËÅØÂ§öÂÄãÈÅéÊøæÂô®ÔºåÁõ¥Âà∞Ê≤íÊúâ<code>chain.doFilter()</code>ÔºåÂ∞±Ë™øÁî®ÁõÆÊ®ôË≥áÊ∫êÁöÑ<code>service()</code>ÊñπÊ≥ï</li>
<li>ÂÆÉÁöÑÂü∑Ë°åÈ†ÜÂ∫èÔºåÈ°û‰ººÊäädoFilter()Áï∂‰Ωú‰∏≠ÈöîÁöÑ‰∏≠Â∫èÈÅçÊ≠∑
<ul>
<li>F1‰∏äÂçäÈÉ®-F2‰∏äÂçäÈÉ®-Ë≥áÊ∫ê-F2‰∏ãÂçäÈÉ®-F1‰∏ãÂçäÈÉ®</li>
</ul>
</li>
<li>F1„ÄÅF2ÁöÑÈ†ÜÂ∫èÊòØÁî±web.xml‰∏≠Ê®ôÁ±§‰∏ä‰∏ãÊâÄÊ±∫ÂÆö</li>
<li>Â¶ÇÊûúÊòØÁî®Ë®ªËß£ÁöÑÔºåÁÑ°Ê≥ïÊ±∫ÂÆöÈ†ÜÂ∫è
<ul>
<li>ÂØ¶‰Ωú‰∏äÔºåÊØèÂÄãÈÅéÊøæÂô®ÈÉΩÊáâË©≤ÊòØÁç®Á´ãÁöÑÔºå‰∏çÊáâÂèóÈ†ÜÂ∫èÂΩ±ÈüøÂäüËÉΩ</li>
</ul>
</li>
</ul>
<h2 id="ÂØ¶‰Ωú">ÂØ¶‰Ωú</h2>
<blockquote>
<p>ÂºïÁî® <a href="http://c.biancheng.net/servlet2/filter.html">http://c.biancheng.net/servlet2/filter.html</a></p>
</blockquote>
<h3 id="webxml">web.xml</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#8b008b;font-weight:bold">&lt;filter&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;filter-name&gt;</span>myFilter<span style="color:#8b008b;font-weight:bold">&lt;/filter-name&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;filter-class&gt;</span>com.MyFilter<span style="color:#8b008b;font-weight:bold">&lt;/filter-class&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;init-param&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;param-name&gt;</span>name<span style="color:#8b008b;font-weight:bold">&lt;/param-name&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;param-value&gt;</span>ÊàëÁöÑFilter<span style="color:#8b008b;font-weight:bold">&lt;/param-value&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;/init-param&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;init-param&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;param-name&gt;</span>URL<span style="color:#8b008b;font-weight:bold">&lt;/param-name&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;param-value&gt;</span>www.MyFilter.net<span style="color:#8b008b;font-weight:bold">&lt;/param-value&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;/init-param&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/filter&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;filter-mapping&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;filter-name&gt;</span>myFilter<span style="color:#8b008b;font-weight:bold">&lt;/filter-name&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;url-pattern&gt;</span>/login<span style="color:#8b008b;font-weight:bold">&lt;/url-pattern&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;dispatcher&gt;</span>REQUEST<span style="color:#8b008b;font-weight:bold">&lt;/dispatcher&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;dispatcher&gt;</span>FORWARD<span style="color:#8b008b;font-weight:bold">&lt;/dispatcher&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/filter-mapping&gt;</span>
</code></pre></div><h3 id="ÂåπÈÖçË¶èÂâá">ÂåπÈÖçË¶èÂâá</h3>
<blockquote>
<p>Ë¶èÂâáË∑üservlet‰∏ÄÊ®£</p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>Ë¶èÂâá</th>
<th>ÁØÑ‰æã</th>
<th>ÂèØË®™ÂïèÁöÑURL</th>
</tr>
</thead>
<tbody>
<tr>
<td>Á≤æÁ¢∫</td>
<td>‰ª•<code>/</code>ÈñãÂßãÔºå‰∏çËÉΩÂåÖÂê´Ëê¨Áî®Â≠óÂÖÉ<code>*</code>‰∏îÂøÖÈ†àÂÆåÂÖ®ÂåπÈÖç</td>
<td>/myServlet</td>
<td>/myServlet</td>
</tr>
<tr>
<td>Ë∑ØÂæë</td>
<td>‰ª•<code>/</code>ÈñãÂßãÔºå‰∏¶‰ª•<code>/*</code>ÁµêÂ∞æ</td>
<td>/user/</td>
<td>/user/‰πã‰∏ãÈÉΩÂèØ‰ª•</td>
</tr>
<tr>
<td>ÂæåÁ∂¥</td>
<td>‰ª•<code>*.</code>ÈñãÂßãÔºå‰∏¶‰ª•ÊüêÁ®ÆÂæåÁ∂¥ÁµêÂ∞æ</td>
<td>*.jsp</td>
<td>Â∑•Á®ãÁõÆÈåÑ‰∏ãÊâÄÊúâ.jsp</td>
</tr>
</tbody>
</table>
<ul>
<li>‰ΩÜÊòØË¶ÅÊ≥®ÊÑèÔºåservletÂåπÈÖçÊòØÂæû‰∏äÂà∞‰∏ãÔºåÊúâÁ¨¶ÂêàÂ∞±‰∫§Áµ¶ÂÆÉÔºåÂâ©‰∏ã‰∏çÁÆ°Ôºå‰∏ÄÊ¨°ÂøÖÁÑ∂Âè™Êúâ‰∏ÄÂÄãservletÂü∑Ë°å</li>
<li>‰ΩÜfilterÊòØÂè™Ë¶ÅÁ¨¶ÂêàÂåπÈÖçË¶èÂâáÂ∞±ÈÄöÈÄöÊäìËµ∑‰æÜÁØ©ÔºåÊâÄ‰ª•ÂèØËÉΩÁ¨¶ÂêàÂ§öÂÄã‰∏îfilterÂÖ®ÈÉΩÂü∑Ë°å</li>
</ul>
<h3 id="Ë®ªËß£">Ë®ªËß£</h3>
<ul>
<li>
<p>@WebFilter Ê≥®Ëß£‰πüÂèØ‰ª•Â∞çÁØ©Ê™¢Á®ãÂºèÈÄ≤Ë°åÈÖçÁΩÆÔºåÂÆπÂô®Âú®ÈÉ®ÁΩ≤ÊáâÁî®ÊôÇÔºåÊúÉÊ†πÊìöÂÖ∂ÂÖ∑È´îÂ±¨ÊÄßÈÖçÁΩÆÂ∞áÁõ∏ÊáâÁöÑÈ°ûÈÉ®ÁΩ≤ÁÇ∫ÁØ©Ê™¢Á®ãÂºè</p>
</li>
<li>
<p>@WebFilter Ê≥®Ëß£ÂÖ∑Êúâ‰∏ãË°®Áµ¶Âá∫ÁöÑ‰∏Ä‰∫õÂ∏∏Áî®Â±¨ÊÄß„ÄÇ‰ª•‰∏ãÊâÄÊúâÂ±¨ÊÄßÂùáÁÇ∫ÂèØÈÅ∏Â±¨ÊÄßÔºå‰ΩÜ value„ÄÅurlPatterns„ÄÅservletNames ‰∏âËÄÖÂøÖÈúÄËá≥Â∞ëÂåÖÂê´‰∏ÄÂÄãÔºå‰∏î value Âíå urlPatterns ‰∏çËÉΩÂÖ±Â≠òÔºåÂ¶ÇÊûúÂêåÊôÇÊåáÂÆöÔºåÈÄöÂ∏∏ÂøΩÁï• value ÁöÑÂèñÂÄº</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Â±¨ÊÄßÂêç</strong></th>
<th><strong>È°ûÂûã</strong></th>
<th><strong>ÊèèËø∞</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>filterName</td>
<td>String</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÁöÑ name Â±¨ÊÄßÔºåÁ≠âÂÉπÊñº <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>urlPatterns</td>
<td>String[]</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÁöÑ URL ÂåπÈÖçÊ®°Âºè„ÄÇÁ≠âÂÉπÊñº <!-- raw HTML omitted --> Ê®ôÁ±§</td>
</tr>
<tr>
<td>value</td>
<td>String[]</td>
<td>Ë©≤Â±¨ÊÄßÁ≠âÂÉπÊñº urlPatterns Â±¨ÊÄßÔºå‰ΩÜÊòØÂÖ©ËÄÖ‰∏çËÉΩÂêåÊôÇ‰ΩøÁî®</td>
</tr>
<tr>
<td>servletNames</td>
<td>String[]</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÂ∞áÊáâÁî®ÊñºÂì™‰∫õ Servlet„ÄÇÂèñÂÄºÊòØ @WebServlet ‰∏≠ filterName Â±¨ÊÄßÁöÑÂèñÂÄºÔºåÊàñËÄÖ web.xml ‰∏≠  <!-- raw HTML omitted --> ÁöÑÂèñÂÄº</td>
</tr>
<tr>
<td>dispatcherTypes</td>
<td>DispatcherType</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÊîîÊà™ÁöÑË≥áÊ∫êË¢´ Servlet ÂÆπÂô®Ë™øÁî®ÁöÑÊñπÂºè„ÄÇÂÖ∑È´îÂèñÂÄºÂåÖÊã¨ÔºöASYNC„ÄÅERROR„ÄÅFORWARD„ÄÅINCLUDE„ÄÅREQUEST</td>
</tr>
<tr>
<td>initParams</td>
<td>WebInitParam[]</td>
<td>ÊåáÂÆö‰∏ÄÁµÑÁØ©Ê™¢Á®ãÂºèÂàùÂßãÂåñÂèÉÊï∏ÔºåÁ≠âÂÉπÊñº <!-- raw HTML omitted --> Ê®ôÁ±§</td>
</tr>
<tr>
<td>asyncSupported</td>
<td>boolean</td>
<td>ËÅ≤ÊòéÁØ©Ê™¢Á®ãÂºèÊòØÂê¶ÊîØÊè¥ÈùûÂêåÊ≠•‰ΩúÊ•≠Ê®°ÂºèÔºåÁ≠âÂÉπÊñº <!-- raw HTML omitted --> Ê®ôÁ±§</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÁöÑÊèèËø∞Ë≥áË®äÔºåÁ≠âÂÉπÊñº <!-- raw HTML omitted --> Ê®ôÁ±§</td>
</tr>
<tr>
<td>displayName</td>
<td>String</td>
<td>ÊåáÂÆöÁØ©Ê™¢Á®ãÂºèÁöÑÈ°ØÁ§∫ÂêçÔºåÁ≠âÂÉπÊñº <!-- raw HTML omitted --> Ê®ôÁ±§</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@WebFilter</span>(filterName=<span style="color:#cd5555">&#34;FirstFilter&#34;</span>,urlPatterns={<span style="color:#cd5555">&#34;/first&#34;</span>,<span style="color:#cd5555">&#34;*.do&#34;</span>,<span style="color:#cd5555">&#34;*.jsp&#34;</span>})
</code></pre></div><h3 id="ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ">ÊáâÁî®Ëá≥Êõ∏ÂüéÈ†ÖÁõÆ</h3>
<blockquote>
<p>‰∏çË¶ÅÂ∞éÈåØÂåÖÔºåÊòØjavaxÁöÑ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@WebFilter</span>(filterName = <span style="color:#cd5555">&#34;ManagerFilter&#34;</span>, urlPatterns = {<span style="color:#cd5555">&#34;/pages/manager/*&#34;</span>, <span style="color:#cd5555">&#34;/manager/*&#34;</span>, <span style="color:#cd5555">&#34;/BookServlet&#34;</span>})
<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">ManagerFilter</span> <span style="color:#8b008b;font-weight:bold">implements</span> Filter {
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">init</span>(FilterConfig config) <span style="color:#8b008b;font-weight:bold">throws</span> ServletException {
    }

    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">destroy</span>() {
    }

    <span style="color:#707a7c">@Override</span>
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">doFilter</span>(ServletRequest request, ServletResponse response, FilterChain chain) <span style="color:#8b008b;font-weight:bold">throws</span> ServletException
            , IOException {
        HttpServletRequest httpServletRequest = (HttpServletRequest) request;
        User user = (User) httpServletRequest.<span style="color:#658b00">getSession</span>().<span style="color:#658b00">getAttribute</span>(<span style="color:#cd5555">&#34;user&#34;</span>);
        <span style="color:#8b008b;font-weight:bold">if</span> (user == <span style="color:#8b008b;font-weight:bold">null</span>) {
            httpServletRequest.<span style="color:#658b00">getRequestDispatcher</span>(<span style="color:#cd5555">&#34;/pages/user/login.jsp&#34;</span>).<span style="color:#658b00">forward</span>(request, response);
        } <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (user.<span style="color:#658b00">getId</span>() &lt;= 3) {
            <span style="color:#228b22">// Âà§Êñ∑ÁÇ∫ÁÆ°ÁêÜÂì°ID
</span><span style="color:#228b22"></span>            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;ÊúâÁÆ°ÁêÜÂì°‰æÜÊìç‰Ωú&#34;</span>);
            chain.<span style="color:#658b00">doFilter</span>(request, response);
        } <span style="color:#8b008b;font-weight:bold">else</span> {
            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;ÈõñÁÑ∂ÁôªÂÖ•‰ΩÜ‰∏çÊòØÁÆ°ÁêÜÂì°&#34;</span>);
            request.<span style="color:#658b00">getRequestDispatcher</span>(<span style="color:#cd5555">&#34;/pages/user/login.jsp&#34;</span>).<span style="color:#658b00">forward</span>(request, response);
        }
    }
}
</code></pre></div><hr>
<h1 id="threadlocal">ThreadLocal</h1>
<blockquote>
<p><a href="http://www.jasongj.com/java/threadlocal/">http://www.jasongj.com/java/threadlocal/</a></p>
<p><a href="https://kucw.github.io/blog/2018/7/java-thread-local/">https://kucw.github.io/blog/2018/7/java-thread-local/</a></p>
</blockquote>
<ul>
<li>Áî®ÊñºÂú®Âêå‰∏ÄÂÄãÁ∑öÁ®ã‰∏≠Â≠òÂèñ‰∏ÄÂÄãË≥áÊñô</li>
<li>ÊüêÊñπÈù¢‰æÜË™™ÂèØ‰ª•Ëß£Ê±∫Á∑öÁ®ãË≥áÊñôÂÆâÂÖ®ÂïèÈ°åÔºå‰ΩÜÊòØÊúâÂçÄÂà•</li>
<li>ThreadLocalÈÅ©Áî®ÊñºÊØèÂÄãÁ∑öÁ®ãÈúÄË¶ÅËá™Â∑±Áç®Á´ãÁöÑÂØ¶‰æã‰∏îË©≤ÂØ¶‰æãÈúÄË¶ÅÂú®Â§öÂÄãÊñπÊ≥ï‰∏≠Ë¢´‰ΩøÁî®Ôºå‰πüÂç≥ËÆäÊï∏Âú®Á∑öÁ®ãÈñìÈöîÈõ¢ËÄåÂú®ÊñπÊ≥ïÊàñÈ°ûÈñìÂÖ±Áî®ÁöÑÂ†¥ÊôØ</li>
<li>SynchronizeÊòØÊáâÁî®Âú®Â§öÁ∑öÁ®ãÈñì&quot;ÂÖ±Áî®ËÆäÈáè&quot;ÁöÑÂä†Ëß£Èéñ</li>
<li>ThreadLocalÊòØ‰∏ÄÂÄãÁ∑öÁ®ãÁöÑ‰∏ÄÂÄãËÆäÈáèÂú®&quot;Â§öÂÄãÊñπÊ≥ï&quot;ÈñìÂÇ≥ÈÅû
<ul>
<li>Âú®ÊñπÊ≥ïÂèÉÊï∏ÈÉΩÂºïÁî®ÈÇ£ÂÄãËÆäÈáè‰πüÂèØ‰ª•ÈÅîÊàêÔºå‰ΩÜÊòØÂ∞±ÈúÄË¶ÅÊØèÂÄãÊñπÊ≥ïÈÉΩÂÇ≥ÂèÉÔºå‰∏çÂ§†ÂÑ™ÈõÖ‰∏îËÄ¶ÂêàÈ´ò</li>
<li>ThreadLocalÂ∫ïÂ±§Êúâ‰∏ÄÂÄãThreadLocalMapÔºåÁî®setËàágetÊñπÊ≥ïÂ∞±ËÉΩÂ≠òÂèñÂÄº(keyÂõ∫ÂÆöÊòØThreadLocalÁöÑIDÔºåÊâÄ‰ª•Âè™ËÉΩÂ≠ò‰∏ÄÂÄãÂÄº)</li>
<li>ÁôΩË©±:ÁêÜËß£ÁÇ∫&quot;Á∑öÁ®ãÂüü&quot;</li>
</ul>
</li>
<li>ÊáâÁî®Â†¥ÊôØ:Session„ÄÅÁ∑öÁ®ãÊ±†‰∫ãÂãô</li>
</ul>
<h2 id="‰ΩøÁî®">‰ΩøÁî®</h2>
<ul>
<li>ÂâçÊèêÊòØÂêå‰∏ÄÂÄãÁ∑öÁ®ã</li>
<li>‰∏ÄËà¨ÈÉΩÊúÉË®≠ÊàêstaticÔºåÊñπ‰æøË∑®ÊñπÊ≥ïË≥áÊñôÁöÑÂ≠òÂèñÔºå‰æãÂ¶Ç</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> ThreadLocal&lt;Ë≥áÊñôÁöÑÈ°û&gt; Ë≥áÊñô = <span style="color:#8b008b;font-weight:bold">new</span> ThreadLocal&lt;&gt;();
</code></pre></div><h2 id="ÁØÑ‰æã">ÁØÑ‰æã</h2>
<blockquote>
<p>Áî®‰æÜÁ¢∫‰øù‰∏ÄÂÄãÁ∑öÁ®ã‰ΩøÁî®Âêå‰∏ÄÂÄãconnÈÄ£Êé•Ë≥áÊñôÂ∫´Ôºå‰æÜÂÆåÊàê‰∫ãÂãôÊìç‰Ωú</p>
</blockquote>
<ul>
<li><code>JdbcUtils.java</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">JdbcUtils</span> {
    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> DruidDataSource dataSource;
    <span style="color:#228b22">// ÈÄ†‰∏ÄÂÄãThreadLocalÔºåË£°Èù¢Â≠òÁöÑÊòØConnection
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// ÊàëÈ†êÊúüËÆìÂêå‰∏ÄÂÄãÁ∑öÁ®ãÈÉΩÁî®Âêå‰∏ÄÂÄãconn‰æÜÂÆåÊàêË≥áÊñôÂ∫´ÁöÑ‰∫ãÂãôÊìç‰Ωú
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// Âõ†ÁÇ∫‰∫ãÂãôË¶ÅÂÖ®ÈÉ®Êèê‰∫§ÊàñÂÖ®ÈÉ®ÂõûÊªæÊâÄ‰ª•ÈúÄË¶ÅÊòØÂêå‰∏ÄÂÄãconn
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">static</span> ThreadLocal&lt;Connection&gt; threadLocalConn = <span style="color:#8b008b;font-weight:bold">new</span> ThreadLocal&lt;&gt;();

    <span style="color:#228b22">// ËÆÄÂèñË®≠ÂÆö
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">static</span> {
        Properties properties = <span style="color:#8b008b;font-weight:bold">new</span> Properties();
        <span style="color:#8b008b;font-weight:bold">try</span> {
            properties.<span style="color:#658b00">load</span>(JdbcUtils.<span style="color:#658b00">class</span>.<span style="color:#658b00">getClassLoader</span>().<span style="color:#658b00">getResourceAsStream</span>(<span style="color:#cd5555">&#34;jdbc.properties&#34;</span>));
            dataSource = (DruidDataSource) DruidDataSourceFactory.<span style="color:#658b00">createDataSource</span>(properties);
        } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
            e.<span style="color:#658b00">printStackTrace</span>();
        }
    }

    <span style="color:#228b22">// Áç≤ÂèñÈÄ£Êé•ÔºåËøîÂõûnullË™™ÊòéÈÄ£Êé•Â§±Êïó
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> Connection <span style="color:#008b45">getConnection</span>() {
        <span style="color:#228b22">// ÂæûthreadLocalÊãøÈÄ£Êé•
</span><span style="color:#228b22"></span>        Connection conn = threadLocalConn.<span style="color:#658b00">get</span>();
        <span style="color:#8b008b;font-weight:bold">if</span> (conn == <span style="color:#8b008b;font-weight:bold">null</span>) {
            <span style="color:#228b22">// Ë£°Èù¢ÈÇÑÊ≤íÂ≠òÊù±Ë•øÂë¢
</span><span style="color:#228b22"></span>            <span style="color:#8b008b;font-weight:bold">try</span> {
                <span style="color:#228b22">// Â∞±ÂæûÈÄ£Êé•Ê±†Êãø‰∏ÄÂÄãÊñ∞ÁöÑÈÄ£Á∑ö
</span><span style="color:#228b22"></span>                conn = dataSource.<span style="color:#658b00">getConnection</span>();
                <span style="color:#228b22">// ‰∏¶‰∏îÂ≠òÂà∞Á∑öÁ®ãÂüü‰∏≠Ôºå‰ª•ÂæåÈÉΩË™øÁî®ÂÆÉ
</span><span style="color:#228b22"></span>                threadLocalConn.<span style="color:#658b00">set</span>(conn);
                <span style="color:#228b22">// Ë®≠ÁΩÆÊâãÂãïÊèê‰∫§Ê∫ñÂÇôÊêû‰∫ãÂãô
</span><span style="color:#228b22"></span>                conn.<span style="color:#658b00">setAutoCommit</span>(<span style="color:#8b008b;font-weight:bold">false</span>);
            } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
                e.<span style="color:#658b00">printStackTrace</span>();
            }
        }
        <span style="color:#8b008b;font-weight:bold">return</span> conn;
    }

    <span style="color:#228b22">/**
</span><span style="color:#228b22">     * Êèê‰∫§‰∫ãÂãô‰∏¶‰∏îÈóúÈñâ
</span><span style="color:#228b22">     */</span>
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">commitAndClose</span>() {
        <span style="color:#228b22">// ÁèæÂú®‰∏çÈúÄË¶ÅÊääconnÁï∂‰ΩúÂèÉÊï∏ÂÇ≥ÈÄ≤‰æÜ‰∫ÜÔºåÂõ†ÁÇ∫Âêå‰∏ÄÂÄãÁ∑öÁ®ãÊàëgetÂ∞±ËÉΩÂèñÂà∞ÂÆÉ
</span><span style="color:#228b22"></span>        Connection conn = threadLocalConn.<span style="color:#658b00">get</span>();
        <span style="color:#8b008b;font-weight:bold">if</span> (conn != <span style="color:#8b008b;font-weight:bold">null</span>) {
            <span style="color:#228b22">// Ë°®Á§∫ÈÄôÂÄãÁ∑öÁ®ã‰∏≠ÊúâÊüêdaoÂèñ‰∫ÜÈÄ£Êé•‰∏¶ÂÅö‰∫ÜÊüê‰∫õÊìç‰Ωú
</span><span style="color:#228b22"></span>            <span style="color:#8b008b;font-weight:bold">try</span> {
                <span style="color:#228b22">// Êèê‰∫§
</span><span style="color:#228b22"></span>                conn.<span style="color:#658b00">commit</span>();
            } <span style="color:#8b008b;font-weight:bold">catch</span> (SQLException e) {
                e.<span style="color:#658b00">printStackTrace</span>();
            } <span style="color:#8b008b;font-weight:bold">finally</span> {
                <span style="color:#8b008b;font-weight:bold">try</span> {
                    conn.<span style="color:#658b00">close</span>();
                } <span style="color:#8b008b;font-weight:bold">catch</span> (SQLException e) {
                    e.<span style="color:#658b00">printStackTrace</span>();
                }
            }
            <span style="color:#228b22">// Èä∑ÊØÄÁ∑öÁ®ã‰∏≠ÁöÑconnÈò≤Ê≠¢Ë®òÊÜ∂È´îÊ¥©ÊºèÔºå
</span><span style="color:#228b22"></span>            <span style="color:#228b22">// ÈõñÁÑ∂GCÂÖßÂª∫ÊúÉÂÅöÈÄô‰∫ãÔºå‰ΩÜÊâãÂãïÂèØ‰ª•Â¢ûÂä†ÊïàÁéá
</span><span style="color:#228b22"></span>            <span style="color:#228b22">// ‰∏îTomcat‰ΩøÁî®‰∫ÜÁ∑öÁ®ãÊ±†Ôºå‰∏çÊâãÂãïremoveÊúÉÁõ¥Êé•Â†±ÈåØ
</span><span style="color:#228b22"></span>            threadLocalConn.<span style="color:#658b00">remove</span>();
        }
    }

    <span style="color:#228b22">/**
</span><span style="color:#228b22">     * ÂõûÊªæ‰∫ãÂãô‰∏¶‰∏îÈóúÈñâ
</span><span style="color:#228b22">     */</span>
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">rollbackAndClose</span>() {
        Connection conn = threadLocalConn.<span style="color:#658b00">get</span>();
        <span style="color:#8b008b;font-weight:bold">if</span> (conn != <span style="color:#8b008b;font-weight:bold">null</span>) {
            <span style="color:#8b008b;font-weight:bold">try</span> {
                <span style="color:#228b22">// ÂõûÊªæ
</span><span style="color:#228b22"></span>                conn.<span style="color:#658b00">rollback</span>();
            } <span style="color:#8b008b;font-weight:bold">catch</span> (SQLException e) {
                e.<span style="color:#658b00">printStackTrace</span>();
            } <span style="color:#8b008b;font-weight:bold">finally</span> {
                <span style="color:#8b008b;font-weight:bold">try</span> {
                    conn.<span style="color:#658b00">close</span>();
                } <span style="color:#8b008b;font-weight:bold">catch</span> (SQLException e) {
                    e.<span style="color:#658b00">printStackTrace</span>();
                }
            }
            threadLocalConn.<span style="color:#658b00">remove</span>();
        }
    }

    <span style="color:#228b22">// // ÈóúÈñâÈÄ£Êé•
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// public static void close(Connection conn) {
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//     if (conn != null) {
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//         try {
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//             conn.close();
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//         } catch (SQLException e) {
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//             e.printStackTrace();
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//         }
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//     }
</span><span style="color:#228b22"></span>    <span style="color:#228b22">//
</span><span style="color:#228b22"></span>    <span style="color:#228b22">// }
</span><span style="color:#228b22"></span>}
</code></pre></div><ul>
<li>‰øÆÊîπ<code>baseDao</code>‰∏≠ÊØèÂÄãÊìç‰ΩúË≥áÊñôÂ∫´ÁöÑÊñπÊ≥ïÔºåÊääÂéü‰æÜÁöÑclose()ÊñπÊ≥ïÂéªÊéâÔºå‰∏¶‰∏îÂú®Âá∫ÈåØÊôÇÊâãÂãïÊããÂá∫Áï∞Â∏∏</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">int</span> <span style="color:#008b45">update</span>(String sql, Object... args) {
    Connection conn = JdbcUtils.<span style="color:#658b00">getConnection</span>();
    <span style="color:#8b008b;font-weight:bold">try</span> {
        <span style="color:#8b008b;font-weight:bold">return</span> queryRunner.<span style="color:#658b00">update</span>(conn, sql, args);
    } <span style="color:#8b008b;font-weight:bold">catch</span> (SQLException e) {
        e.<span style="color:#658b00">printStackTrace</span>();
        <span style="color:#228b22">// ÈÅáÂà∞Áï∞Â∏∏ÊâãÂãïÂæÄÂ§ñÊããÔºåÂê¶Ââá‰∫ãÂãô‰∏çÁü•ÈÅìË¶ÅÂõûÊªæ
</span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> RuntimeException(e);
    }
}
</code></pre></div><ul>
<li>ServiceÂ±§Âè™ÊòØÁ∞°ÂñÆÁöÑË™øÁî®daoÔºåÊ≤íÊúâÊããÂá∫Áï∞Â∏∏</li>
<li>Êé•ËëóÂ∞±Âà∞‰∫Ü<code>baseServlet</code>ÔºåÈÄôÈÇäÁî®ÂèçÂ∞ÑÂà§Êñ∑Ë´ãÊ±ÇÂ∞çÊáâÁöÑÊñπÊ≥ïËΩâÁµ¶ÂêÑÂÄãServiceÔºå‰πüÊçïÁç≤‰∫ÜÁï∞Â∏∏ÔºåÈúÄË¶ÅÊâãÂãïÊããÂá∫</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@Override</span>
<span style="color:#8b008b;font-weight:bold">protected</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">doPost</span>(HttpServletRequest request, HttpServletResponse response) <span style="color:#8b008b;font-weight:bold">throws</span> ServletException,
        IOException {
    request.<span style="color:#658b00">setCharacterEncoding</span>(<span style="color:#cd5555">&#34;UTF-8&#34;</span>);
    <span style="color:#228b22">// Âà§Êñ∑Ë´ãÊ±ÇÁöÑÈö±ËóèÊ®ôÁ±§
</span><span style="color:#228b22"></span>    String action = request.<span style="color:#658b00">getParameter</span>(<span style="color:#cd5555">&#34;action&#34;</span>);
    <span style="color:#8b008b;font-weight:bold">try</span> {
        <span style="color:#228b22">// Áî®ÂèçÂ∞ÑÊâæÂà∞ÊñπÊ≥ï
</span><span style="color:#228b22"></span>        Method declaredMethod = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">getClass</span>().<span style="color:#658b00">getDeclaredMethod</span>(action, HttpServletRequest.<span style="color:#658b00">class</span>,
                HttpServletResponse.<span style="color:#658b00">class</span>);
        <span style="color:#228b22">// Ë™øÁî®ÊñπÊ≥ï
</span><span style="color:#228b22"></span>        declaredMethod.<span style="color:#658b00">invoke</span>(<span style="color:#8b008b;font-weight:bold">this</span>, request, response);
    } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
        e.<span style="color:#658b00">printStackTrace</span>();
        <span style="color:#228b22">// ÊâãÂãïÊããÂá∫Áï∞Â∏∏Áµ¶ÈÅéÊøæÂô®
</span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> RuntimeException(e);
    }
}
</code></pre></div><ul>
<li>ÊúÄÂæå‰æÜÂà∞ÈÅéÊøæÂô®ÔºåÈÅéÊøæÊ¢ù‰ª∂Ë®≠ÂÆö<code>&quot;/*&quot;</code>ËÆìÊâÄÊúâ‰∫∫ÈÉΩË¶ÅË¢´ÈÅéÊøæ</li>
<li>‰∏ÄÂÄãÁ∑öÁ®ãÁöÑÊâÄÊúâË´ãÊ±Ç„ÄÅÊ∂âÂèäÁöÑÊñπÊ≥ïÈÉΩË¶ÅÁ∂ìÈÅé<code>doFilter</code>ÊñπÊ≥ïÊâçËÉΩÂ±§Â±§ÂæÄ‰∏ãË™øÁî®<code>servlet &gt; service &gt; dao</code>Ôºå‰∏¶‰∏îÊàëÁî®ThreadLocalÁ¢∫‰øùÂÆÉÈÉΩÊòØÂêå‰∏ÄÂÄãconn‰∫ÜÔºåÂè™Ë¶Å‰ªª‰Ωï‰∏ÄÂÄãÁí∞ÁØÄÂá∫ÈåØÔºåÂ∞±ÂõûÊªæÔºå‰ª•Ê≠§ÂÆåÊàê‰∫ãÂãôÊìç‰Ωú</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@WebFilter</span>(filterName = <span style="color:#cd5555">&#34;TransactionFilter&#34;</span>, value = <span style="color:#cd5555">&#34;/*&#34;</span>)
<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">TransactionFilter</span> <span style="color:#8b008b;font-weight:bold">implements</span> Filter {
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">init</span>(FilterConfig config) <span style="color:#8b008b;font-weight:bold">throws</span> ServletException {
    }

    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">destroy</span>() {
    }

    <span style="color:#707a7c">@Override</span>
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">doFilter</span>(ServletRequest request, ServletResponse response, FilterChain chain) <span style="color:#8b008b;font-weight:bold">throws</span> ServletException
            , IOException {
        <span style="color:#228b22">// Âõ†ÁÇ∫ÁØ©ÈÅ∏Ê¢ù‰ª∂ÊòØ/*ÊâÄÊúâ‰∫∫ÈÉΩË¶Å‰æÜÈÄôÈóúÔºåÁï∂ÁÑ∂‰πüÂåÖÂê´‰∫ÜÊâÄÊúâ‰∫ãÂãô
</span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">try</span> {
            chain.<span style="color:#658b00">doFilter</span>(request, response);
            <span style="color:#228b22">// Âú®Ê≠§Êèê‰∫§‰∫ãÂãô
</span><span style="color:#228b22"></span>            JdbcUtils.<span style="color:#658b00">commitAndClose</span>();
        } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
            <span style="color:#228b22">// Âá∫ÈåØÂ∞±ÂõûÊªæÔºåÂâõÂâõËÆìbaseServletÊâãÂãïÊããÂá∫Â∞±ÊòØÁÇ∫‰∫ÜÂú®ÈÄôÈÇäËÉΩÊé•Âà∞
</span><span style="color:#228b22"></span>            JdbcUtils.<span style="color:#658b00">rollbackAndClose</span>();
            e.<span style="color:#658b00">printStackTrace</span>();
        }
    }
}
</code></pre></div><h3 id="tomcatÈåØË™§È†ÅÈù¢">TomcatÈåØË™§È†ÅÈù¢</h3>
<blockquote>
<p>Â±ïÁ§∫ÂèãÂ•ΩÁöÑÈåØË™§È†ÅÈù¢</p>
</blockquote>
<ul>
<li>ÂìàÂìàÂâõÂâõÁöÑ<code>/*</code>ÈÅéÊøæÂô®ÈÇÑÊúâÊà≤ÔºåÂõ†ÁÇ∫ÂÆÉÊòØÈÅéÊøæÊâÄÊúâÔºåËá™ÁÑ∂‰πüÊúÉÊäì‰ΩèÊâÄÊúâÁï∞Â∏∏ÔºåÈÄôË£°ÊääÁï∞Â∏∏ÂÜçÂæÄÂ§ñÊãã</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
<span style="color:#228b22">// Âá∫ÈåØÂ∞±ÂõûÊªæÔºåÂâõÂâõËÆìbaseServletÊâãÂãïÊããÂá∫Â∞±ÊòØÁÇ∫‰∫ÜÂú®ÈÄôÈÇäËÉΩÊé•Âà∞
</span><span style="color:#228b22"></span>JdbcUtils.<span style="color:#658b00">rollbackAndClose</span>();
e.<span style="color:#658b00">printStackTrace</span>();
<span style="color:#228b22">// ÊâãÂãïÊããÂá∫Áï∞Â∏∏Áµ¶Tomcat
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> RuntimeException(e);
}
</code></pre></div><ul>
<li>web.xml</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#8b008b;font-weight:bold">&lt;error-page&gt;</span>
	<span style="color:#8b008b;font-weight:bold">&lt;location&gt;</span>/pages/error/error.html<span style="color:#8b008b;font-weight:bold">&lt;/location&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/error-page&gt;</span>

‰πüÂèØ‰ª•ÊåáÂÆö
<span style="color:#8b008b;font-weight:bold">&lt;error-page&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;error-code&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;exception-type&gt;</span>
        Êää‰∏çÂêåÈ°ûÂûãÁöÑerrorÂºïÂ∞éÂà∞Â∞çÊáâÁöÑÈ†ÅÈù¢
</code></pre></div>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">‰∏äÊ¨°‰øÆÊîπÊñº 2022-01-10</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220111-agg-javaweb-11/">
			‰∏ã‰∏ÄÁØá<br>JSON„ÄÅAJAX„ÄÅi18n
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220109-agg-javaweb-09/">
			‰∏ä‰∏ÄÁØá<br>CookieËàáSessionÔºåÊõ∏ÂüéË®ÇÂñÆÊ®°ÁµÑ
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ÁßªÊ§çËá™ <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
